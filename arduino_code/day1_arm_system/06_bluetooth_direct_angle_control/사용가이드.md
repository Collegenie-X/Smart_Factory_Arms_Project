# 06번 - Bluetooth 각도 직접 제어 사용 가이드

## 목차
1. [시작하기](#시작하기)
2. [기본 사용법](#기본-사용법)
3. [실전 예제](#실전-예제)
4. [앱 인벤터 연동](#앱-인벤터-연동)
5. [문제 해결](#문제-해결)

---

## 시작하기

### 1단계: 하드웨어 연결

#### Bluetooth 모듈 연결
```
HC-05/06 모듈:
┌─────────────┐
│ VCC  →  5V  │
│ GND  →  GND │
│ TX   →  3번 │
│ RX   →  2번 │
└─────────────┘
```

#### 서보 모터 연결
```
서보 모터:
┌──────────────────┐
│ 베이스   →  4번  │
│ 팔꿈치   →  5번  │
│ 손목     →  6번  │
│ 그립     →  7번  │
└──────────────────┘
```

### 2단계: 코드 업로드
1. Arduino IDE 실행
2. `06_bluetooth_direct_angle_control.ino` 파일 열기
3. 보드 선택: Arduino Uno
4. 포트 선택
5. 업로드 버튼 클릭

### 3단계: Bluetooth 페어링
1. 스마트폰 설정 → Bluetooth
2. HC-05 또는 HC-06 검색
3. 페어링 코드: `1234` 또는 `0000`

---

## 기본 사용법

### 명령어 형식

#### 1. 각도 직접 제어 (신규)
```
형식: 베이스,팔꿈치,손목,그립_

예시:
90,80,90,30_
```

**중요 규칙:**
- 4개의 각도를 쉼표(`,`)로 구분
- 마지막에 언더스코어(`_`) 필수
- 공백 없이 입력

#### 2. 기존 명령어
```
save_   : 현재 위치 저장
play_   : 저장된 동작 1회 재생
auto_   : 자동 반복 시작
stop_   : 자동 반복 중지
clear_  : 모든 위치 삭제
list_   : 저장된 위치 목록
```

### 각도 범위 참고

| 서보 | 최소 | 최대 | 중간 | 용도 |
|------|------|------|------|------|
| 베이스 | 0° | 180° | 90° | 좌우 회전 |
| 팔꿈치 | 50° | 110° | 80° | 위아래 |
| 손목 | 60° | 120° | 90° | 위아래 |
| 그립 | 10° | 60° | 15° | 열림/닫힘 |

**팁:**
- 그립 10°: 완전히 열림
- 그립 60°: 완전히 닫힘
- 그립 30°: 물건 잡기 적당

---

## 실전 예제

### 예제 1: 물건 집기 동작

```
단계별 명령:

1. 초기 위치 (대기)
   90,80,90,15_

2. 물건 위로 이동
   90,100,90,15_

3. 그립 닫기 (물건 잡기)
   90,100,90,40_

4. 들어올리기
   90,80,90,40_

5. 회전
   180,80,90,40_

6. 내려놓기
   180,100,90,40_

7. 그립 열기
   180,100,90,15_

8. 초기 위치로
   90,80,90,15_
```

### 예제 2: 스캔 동작

```
좌측에서 우측으로 스캔:

0,80,90,15_
45,80,90,15_
90,80,90,15_
135,80,90,15_
180,80,90,15_
```

### 예제 3: 분류 작업

```
1. 물건 감지 위치
   90,100,100,15_

2. 물건 잡기
   90,100,100,35_

3. 색상 확인 위치로 이동
   90,80,90,35_

4. 빨간색 → 왼쪽 박스
   45,100,90,35_
   45,100,90,15_

5. 파란색 → 오른쪽 박스
   135,100,90,35_
   135,100,90,15_

6. 초기 위치
   90,100,100,15_
```

### 예제 4: 자동화 시퀀스

```
1. 각 위치로 이동하면서 저장
   90,80,90,15_
   save_
   
   90,100,90,15_
   save_
   
   90,100,90,40_
   save_
   
   180,100,90,40_
   save_

2. 저장된 동작 재생
   play_    (1회 재생)
   auto_    (계속 반복)
   stop_    (중지)
```

---

## 앱 인벤터 연동

### 기본 UI 구성

#### 1. 슬라이더 방식
```
[베이스: 0 ━━●━━━━ 180]
[팔꿈치: 50 ━●━━━━ 110]
[손목: 60 ━━●━━━ 120]
[그립: 10 ━●━━━━ 60]

[전송 버튼]
```

**블록 코드:**
```
전송 버튼 클릭 시:
  텍스트 = 베이스슬라이더.값 + "," +
           팔꿈치슬라이더.값 + "," +
           손목슬라이더.값 + "," +
           그립슬라이더.값 + "_"
  Bluetooth.텍스트전송(텍스트)
```

#### 2. 버튼 방식
```
[초기위치]  [물건잡기]  [놓기]
[좌회전]    [우회전]    [리셋]
```

**블록 코드:**
```
초기위치 버튼 클릭 시:
  Bluetooth.텍스트전송("90,80,90,15_")

물건잡기 버튼 클릭 시:
  Bluetooth.텍스트전송("90,100,90,40_")

놓기 버튼 클릭 시:
  Bluetooth.텍스트전송("90,100,90,15_")
```

#### 3. 음성 제어
```
음성인식 결과:
  만약 결과 = "초기위치" 이면:
    Bluetooth.텍스트전송("90,80,90,15_")
  
  만약 결과 = "물건 집어" 이면:
    Bluetooth.텍스트전송("90,100,90,40_")
  
  만약 결과 = "놓아" 이면:
    Bluetooth.텍스트전송("90,100,90,15_")
```

### 고급 기능

#### 1. 각도 저장 및 불러오기
```
저장 버튼:
  TinyDB에 저장:
    키: "위치1"
    값: "90,80,90,30"

불러오기 버튼:
  값 = TinyDB에서 가져오기("위치1")
  Bluetooth.텍스트전송(값 + "_")
```

#### 2. 시퀀스 자동 실행
```
시퀀스 = ["90,80,90,15", "90,100,90,15", "90,100,90,40"]

for 각 명령 in 시퀀스:
  Bluetooth.텍스트전송(명령 + "_")
  대기(1000)  // 1초 대기
```

#### 3. 조이스틱 UI
```
조이스틱 드래그 시:
  베이스각도 = 계산(조이스틱X위치)
  팔꿈치각도 = 계산(조이스틱Y위치)
  
  텍스트 = 베이스각도 + "," + 팔꿈치각도 + ",90,15_"
  Bluetooth.텍스트전송(텍스트)
```

---

## 문제 해결

### 문제 1: 각도가 적용되지 않음

**증상:**
- 명령을 보냈는데 로봇 팔이 움직이지 않음

**해결 방법:**
1. 명령 형식 확인
   ```
   올바름: 90,80,90,30_
   틀림:   90 80 90 30   (쉼표 없음)
   틀림:   90,80,90,30   (언더스코어 없음)
   틀림:   90, 80, 90, 30_  (공백 있음)
   ```

2. 각도 개수 확인
   ```
   올바름: 90,80,90,30_  (4개)
   틀림:   90,80,90_     (3개)
   틀림:   90,80_        (2개)
   ```

3. Serial Monitor로 확인
   ```
   수신: [90,80,90,30]
   목표 각도: 90,80,90,30
   이동 완료
   ```

### 문제 2: Bluetooth 연결 안됨

**해결 방법:**
1. HC-05/06 LED 확인
   - 빠르게 깜빡임: 페어링 대기
   - 느리게 깜빡임: 연결됨

2. 전원 확인
   - VCC → 5V 연결
   - GND → GND 연결

3. TX/RX 확인
   - HC-05 TX → Arduino 3번 (RX)
   - HC-05 RX → Arduino 2번 (TX)

### 문제 3: 서보 떨림

**원인:**
- 전원 부족

**해결 방법:**
1. 외부 5V 전원 사용
2. 전원 용량 확인 (최소 2A)
3. 서보와 아두이노 GND 공통 연결

### 문제 4: 각도 범위 초과

**증상:**
```
경고: 최대각도 제한 적용 [1] 110
```

**설명:**
- 입력한 각도가 범위를 벗어남
- 자동으로 최소/최대값으로 제한됨

**예시:**
```
입력: 90,150,90,30_
실제: 90,110,90,30_  (150 → 110으로 제한)
```

### 문제 5: 명령이 느리게 적용됨

**원인:**
- 부드러운 이동 알고리즘 (delay 15ms)

**해결 방법:**
1. 빠른 이동이 필요하면 코드 수정
   ```cpp
   delay(15);  // 느림
   delay(5);   // 빠름
   ```

2. 또는 각도 차이를 줄임
   ```
   느림: 0,80,90,30_ → 180,80,90,30_
   빠름: 90,80,90,30_ → 100,80,90,30_
   ```

---

## 활용 팁

### 1. 각도 테스트
```
중간 위치에서 시작:
90,80,90,15_

한 번에 하나씩 변경:
100,80,90,15_  (베이스만 +10)
100,90,90,15_  (팔꿈치만 +10)
100,90,100,15_ (손목만 +10)
100,90,100,25_ (그립만 +10)
```

### 2. 안전한 동작
```
1. 항상 그립을 먼저 열기
   현재각도,현재각도,현재각도,15_

2. 천천히 이동
   작은 각도 변화로 여러 번

3. 충돌 방지
   높이 먼저 조정 후 회전
```

### 3. 효율적인 작업
```
1. 자주 사용하는 위치 저장
   90,80,90,15_
   save_

2. 시퀀스로 자동화
   play_ 또는 auto_

3. 앱에서 버튼으로 제어
```

---

## 다음 단계

### 학습 경로
1. ✅ 06번: 각도 직접 제어 (현재)
2. ⬜ 앱 인벤터로 UI 제작
3. ⬜ 음성 제어 추가
4. ⬜ AI 비전 연동
5. ⬜ 컨베이어 시스템 연동

### 추천 프로젝트
1. **색상 분류 로봇**: 색상 센서 + 각도 제어
2. **음성 제어 로봇**: STT + 각도 제어
3. **제스처 로봇**: Teachable Machine + 각도 제어
4. **자동 분류 시스템**: 컨베이어 + 로봇 팔

---

## 참고 자료

### 관련 파일
- `06_bluetooth_direct_angle_control.ino` : 메인 코드
- `README.md` : 기술 문서
- `사용가이드.md` : 이 문서

### 이전 단계
- `05_bluetooth_eeprom_automation` : 기본 Bluetooth 제어
- `04_eeprom_automation` : EEPROM 저장
- `03_serial_servo_control` : Serial 제어

### 다음 단계
- `day2_conveyor_system` : 컨베이어 시스템
- `day3_scenarios` : 통합 시나리오

---

## 문의 및 지원

문제가 해결되지 않으면:
1. Serial Monitor 출력 확인
2. 하드웨어 연결 재확인
3. 코드의 디버그 모드 활성화
4. README.md의 문제 해결 섹션 참고

**Happy Coding! 🤖**

