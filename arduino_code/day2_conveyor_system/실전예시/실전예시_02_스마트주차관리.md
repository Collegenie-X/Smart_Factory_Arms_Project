# ì‹¤ì „ ì˜ˆì‹œ 02: ìŠ¤ë§ˆíŠ¸ ì£¼ì°¨ ê´€ë¦¬ ì‹œìŠ¤í…œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ëª©í‘œ**: ì´ˆìŒíŒŒ ì„¼ì„œë¡œ ì£¼ì°¨ ê³µê°„ì„ ê°ì§€í•˜ê³ , ê±°ë¦¬ì— ë”°ë¼ LEDì™€ ë¶€ì €ë¡œ ì•ˆë‚´

**ë‚œì´ë„**: â­â­â˜†â˜†â˜†

**í•™ìŠµ ëª©í‘œ**:
- ì´ˆìŒíŒŒ ì„¼ì„œ ê±°ë¦¬ ì¸¡ì •
- ë‹¨ê³„ë³„ í”¼ë“œë°± ì œê³µ
- ì‹¤ì‹œê°„ ê±°ë¦¬ í‘œì‹œ

---

## ğŸ¯ ì‹œìŠ¤í…œ êµ¬ì¡°ë„

```mermaid
graph TB
    subgraph INPUT[ì…ë ¥]
        ULTRA[ì´ˆìŒíŒŒ ì„¼ì„œ<br/>HC-SR04<br/>ê±°ë¦¬ ì¸¡ì •]
    end
    
    subgraph PROCESS[ì²˜ë¦¬]
        CALC[ê±°ë¦¬ ê³„ì‚°<br/>cm ë³€í™˜]
        ZONE[êµ¬ì—­ íŒì •<br/>ì•ˆì „/ì£¼ì˜/ìœ„í—˜]
    end
    
    subgraph OUTPUT[ì¶œë ¥]
        LED[RGB LED<br/>ì´ˆë¡/ë…¸ë‘/ë¹¨ê°•]
        BUZZER[ë¶€ì €<br/>ê°„ê²© ë³€í™”]
        LCD[LCD 1602<br/>ê±°ë¦¬ í‘œì‹œ]
        MATRIX[8x8 Matrix<br/>í™”ì‚´í‘œ í‘œì‹œ]
    end
    
    ULTRA -->|ê±°ë¦¬ ë°ì´í„°| CALC
    CALC --> ZONE
    ZONE -->|ì•ˆì „| LED
    ZONE -->|ì£¼ì˜| LED
    ZONE -->|ìœ„í—˜| LED
    ZONE --> BUZZER
    ZONE --> LCD
    ZONE --> MATRIX
    
    style INPUT fill:#E1F5FF,color:#111
    style PROCESS fill:#FFE1E1,color:#111
    style OUTPUT fill:#E1FFE1,color:#111
```

---

## ğŸ“¦ ë¶€í’ˆ ë¦¬ìŠ¤íŠ¸

| ë²ˆí˜¸ | ë¶€í’ˆëª… | ìˆ˜ëŸ‰ | ì‚¬ì–‘ | ìš©ë„ |
|------|--------|------|------|------|
| 1 | ì•„ë‘ì´ë…¸ ìš°ë…¸ | 1 | 5V | ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ |
| 2 | HC-SR04 ì´ˆìŒíŒŒ ì„¼ì„œ | 1 | 5V, 2-400cm | ê±°ë¦¬ ì¸¡ì • |
| 3 | NeoPixel LED | 8 | 5V, 1-Wire | ê±°ë¦¬ í‘œì‹œ |
| 4 | í”¼ì—ì¡° ë¶€ì € | 1 | 5V, PWM | ê²½ê³ ìŒ |
| 5 | LCD 1602 (I2C) | 1 | 5V, I2C | ê±°ë¦¬ ìˆ«ì í‘œì‹œ |
| 6 | 8x8 LED Matrix | 1 | 5V, SPI | í™”ì‚´í‘œ í‘œì‹œ |
| 7 | ë¸Œë ˆë“œë³´ë“œ | 1 | - | íšŒë¡œ êµ¬ì„± |
| 8 | ì í¼ ì™€ì´ì–´ | 25 | - | ì—°ê²° |

**ì˜ˆìƒ ë¹„ìš©**: ì•½ 30,000ì›

---

## ğŸ”Œ í•€ì•„ì›ƒ ì—°ê²°

```mermaid
graph LR
    subgraph ARDUINO[ì•„ë‘ì´ë…¸ ìš°ë…¸]
        D2[D2]
        D3[D3 PWM]
        D4[D4]
        D6[D6 PWM]
        D10[D10 SS]
        D11[D11 MOSI]
        D12[D12 MISO]
        D13[D13 SCK]
        A4[A4 SDA]
        A5[A5 SCL]
        V5[5V]
        GND[GND]
    end
    
    D2 --> TRIG[ì´ˆìŒíŒŒ<br/>Trigger]
    D3 --> ECHO[ì´ˆìŒíŒŒ<br/>Echo]
    D6 --> LED[NeoPixel<br/>DIN]
    D4 --> BUZ[ë¶€ì €]
    
    D10 --> MAT_CS[Matrix<br/>CS]
    D11 --> MAT_DIN[Matrix<br/>DIN]
    D13 --> MAT_CLK[Matrix<br/>CLK]
    
    A4 --> LCD_SDA[LCD<br/>SDA]
    A5 --> LCD_SCL[LCD<br/>SCL]
    
    V5 --> TRIG
    V5 --> LED
    V5 --> BUZ
    V5 --> MAT_CS
    V5 --> LCD_SDA
    
    GND --> TRIG
    GND --> LED
    GND --> BUZ
    GND --> MAT_CS
    GND --> LCD_SDA
    
    style ARDUINO fill:#FFE1E1,color:#111
```

### í•€ ë§µ í…Œì´ë¸”

| ì•„ë‘ì´ë…¸ í•€ | ì—°ê²° ë¶€í’ˆ | ì‹ í˜¸ íƒ€ì… | ì„¤ëª… |
|------------|----------|----------|------|
| D2 | ì´ˆìŒíŒŒ Trigger | ë””ì§€í„¸ ì¶œë ¥ | 10us í„ìŠ¤ |
| D3 | ì´ˆìŒíŒŒ Echo | ë””ì§€í„¸ ì…ë ¥ | ê±°ë¦¬ ì‹ í˜¸ |
| D4 | ë¶€ì € + | PWM | ê²½ê³ ìŒ |
| D6 | NeoPixel DIN | 1-Wire | LED ì œì–´ |
| D10 | Matrix CS | SPI | Chip Select |
| D11 | Matrix DIN | SPI | Data In |
| D13 | Matrix CLK | SPI | Clock |
| A4 (SDA) | LCD SDA | I2C | ë°ì´í„° |
| A5 (SCL) | LCD SCL | I2C | í´ëŸ­ |

---

## ğŸ”„ ë™ì‘ ìˆœì„œë„

```mermaid
flowchart TD
    START([ì‹œì‘]) --> INIT[ì´ˆê¸°í™”]
    INIT --> MEASURE[ê±°ë¦¬ ì¸¡ì •]
    
    MEASURE --> TRIGGER[Trigger 10us]
    TRIGGER --> ECHO_WAIT[Echo ëŒ€ê¸°]
    ECHO_WAIT --> CALC[ê±°ë¦¬ ê³„ì‚°<br/>duration/58]
    
    CALC --> FILTER[í•„í„°ë§<br/>2-400cm]
    FILTER --> ZONE{ê±°ë¦¬ êµ¬ì—­?}
    
    ZONE -->|50cm ì´ìƒ| SAFE[ì•ˆì „ êµ¬ì—­<br/>SAFE]
    ZONE -->|20-50cm| WARN[ì£¼ì˜ êµ¬ì—­<br/>WARNING]
    ZONE -->|20cm ë¯¸ë§Œ| DANGER[ìœ„í—˜ êµ¬ì—­<br/>DANGER]
    
    SAFE --> LED_GREEN[LED ì´ˆë¡<br/>8ê°œ]
    WARN --> LED_YELLOW[LED ë…¸ë‘<br/>4ê°œ]
    DANGER --> LED_RED[LED ë¹¨ê°•<br/>2ê°œ]
    
    LED_GREEN --> BUZ_SLOW[ë¶€ì € ëŠë¦¼<br/>2ì´ˆ ê°„ê²©]
    LED_YELLOW --> BUZ_MED[ë¶€ì € ì¤‘ê°„<br/>1ì´ˆ ê°„ê²©]
    LED_RED --> BUZ_FAST[ë¶€ì € ë¹ ë¦„<br/>0.3ì´ˆ ê°„ê²©]
    
    BUZ_SLOW --> LCD_UPDATE[LCD ê±°ë¦¬ í‘œì‹œ]
    BUZ_MED --> LCD_UPDATE
    BUZ_FAST --> LCD_UPDATE
    
    LCD_UPDATE --> MATRIX_ARROW[Matrix í™”ì‚´í‘œ]
    MATRIX_ARROW --> SERIAL[ì‹œë¦¬ì–¼ ì¶œë ¥]
    
    SERIAL --> DELAY[100ms ëŒ€ê¸°]
    DELAY --> MEASURE
    
    style START fill:#90EE90,color:#111
    style SAFE fill:#90EE90,color:#111
    style WARN fill:#FFD700,color:#111
    style DANGER fill:#FF6B6B,color:#111
```

---

## ğŸ’» ì™„ì „í•œ ì†ŒìŠ¤ ì½”ë“œ

```cpp
/**
 * ìŠ¤ë§ˆíŠ¸ ì£¼ì°¨ ê´€ë¦¬ ì‹œìŠ¤í…œ
 * 
 * ê¸°ëŠ¥:
 * - ì´ˆìŒíŒŒ ì„¼ì„œë¡œ ê±°ë¦¬ ì¸¡ì •
 * - ê±°ë¦¬ë³„ LED ìƒ‰ìƒ ë³€ê²½
 * - ë¶€ì € ê°„ê²© ë³€í™”ë¡œ ê²½ê³ 
 * - LCDì— ê±°ë¦¬ í‘œì‹œ
 * - Matrixì— í™”ì‚´í‘œ í‘œì‹œ
 * 
 * ì‘ì„±ì: Smart Factory Team
 * ë‚ ì§œ: 2026-01-27
 */

// ===== ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨ =====
#include <Adafruit_NeoPixel.h>
#include <LiquidCrystal_I2C.h>
#include <LedControl.h>

// ===== í•€ ì •ì˜ =====
#define PIN_TRIG         2     // ì´ˆìŒíŒŒ Trigger
#define PIN_ECHO         3     // ì´ˆìŒíŒŒ Echo
#define PIN_BUZZER       4     // ë¶€ì €
#define PIN_NEOPIXEL     6     // NeoPixel LED
#define PIN_MATRIX_DIN   11    // Matrix Data
#define PIN_MATRIX_CS    10    // Matrix CS
#define PIN_MATRIX_CLK   13    // Matrix Clock

// ===== ì„¤ì •ê°’ =====
#define NUM_PIXELS       8     // LED ê°œìˆ˜
#define SAFE_DISTANCE    50    // ì•ˆì „ ê±°ë¦¬ (cm)
#define WARN_DISTANCE    20    // ì£¼ì˜ ê±°ë¦¬ (cm)
#define MAX_DISTANCE     400   // ìµœëŒ€ ì¸¡ì • ê±°ë¦¬

// ===== ê°ì²´ ìƒì„± =====
Adafruit_NeoPixel led = Adafruit_NeoPixel(NUM_PIXELS, PIN_NEOPIXEL);
LiquidCrystal_I2C lcd(0x27, 16, 2);
LedControl matrix = LedControl(PIN_MATRIX_DIN, PIN_MATRIX_CLK, PIN_MATRIX_CS, 1);

// ===== êµ¬ì—­ ì •ì˜ =====
enum Zone {
  SAFE,      // ì•ˆì „
  WARNING,   // ì£¼ì˜
  DANGER     // ìœ„í—˜
};

// ===== ì „ì—­ ë³€ìˆ˜ =====
unsigned long lastBuzzerTime = 0;
int buzzerInterval = 2000;
Zone currentZone = SAFE;

// ===== í™”ì‚´í‘œ íŒ¨í„´ (8x8) =====
byte arrowDown[8] = {
  B00011000,
  B00011000,
  B00011000,
  B00011000,
  B01111110,
  B00111100,
  B00011000,
  B00000000
};

byte arrowStop[8] = {
  B11111111,
  B10000001,
  B10000001,
  B10000001,
  B10000001,
  B10000001,
  B10000001,
  B11111111
};

byte arrowWarning[8] = {
  B00011000,
  B00111100,
  B01111110,
  B11111111,
  B00011000,
  B00011000,
  B00011000,
  B00000000
};

/**
 * ì´ˆê¸°í™”
 */
void setup() {
  // ì‹œë¦¬ì–¼ ì‹œì‘
  Serial.begin(9600);
  Serial.println("=== Smart Parking System ===");
  
  // í•€ ëª¨ë“œ ì„¤ì •
  pinMode(PIN_TRIG, OUTPUT);
  pinMode(PIN_ECHO, INPUT);
  pinMode(PIN_BUZZER, OUTPUT);
  
  // LED ì´ˆê¸°í™”
  led.begin();
  led.setBrightness(100);
  led.show();
  
  // LCD ì´ˆê¸°í™”
  lcd.init();
  lcd.backlight();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Parking System");
  lcd.setCursor(0, 1);
  lcd.print("Initializing...");
  
  // Matrix ì´ˆê¸°í™”
  matrix.shutdown(0, false);
  matrix.setIntensity(0, 8);
  matrix.clearDisplay(0);
  
  // ì‹œì‘ ì•Œë¦¼
  tone(PIN_BUZZER, 1000, 200);
  delay(300);
  tone(PIN_BUZZER, 1500, 200);
  
  delay(2000);
  lcd.clear();
  
  Serial.println("System ready");
}

/**
 * ë©”ì¸ ë£¨í”„
 */
void loop() {
  // ê±°ë¦¬ ì¸¡ì •
  int distance = measureDistance();
  
  // í•„í„°ë§ (ìœ íš¨ ë²”ìœ„)
  if (distance < 2 || distance > MAX_DISTANCE) {
    distance = MAX_DISTANCE;
  }
  
  // êµ¬ì—­ íŒì •
  Zone zone = determineZone(distance);
  
  // êµ¬ì—­ ë³€ê²½ ì‹œ ì•Œë¦¼
  if (zone != currentZone) {
    currentZone = zone;
    playZoneChangeSound();
  }
  
  // LED ì—…ë°ì´íŠ¸
  updateLED(distance, zone);
  
  // ë¶€ì € ì—…ë°ì´íŠ¸
  updateBuzzer(zone);
  
  // LCD ì—…ë°ì´íŠ¸
  updateLCD(distance, zone);
  
  // Matrix ì—…ë°ì´íŠ¸
  updateMatrix(zone);
  
  // ì‹œë¦¬ì–¼ ì¶œë ¥
  printStatus(distance, zone);
  
  delay(100);
}

/**
 * ê±°ë¦¬ ì¸¡ì •
 */
int measureDistance() {
  // Trigger ì‹ í˜¸ (10us)
  digitalWrite(PIN_TRIG, LOW);
  delayMicroseconds(2);
  digitalWrite(PIN_TRIG, HIGH);
  delayMicroseconds(10);
  digitalWrite(PIN_TRIG, LOW);
  
  // Echo ì‹ í˜¸ ëŒ€ê¸° (íƒ€ì„ì•„ì›ƒ 30ms)
  long duration = pulseIn(PIN_ECHO, HIGH, 30000);
  
  // ê±°ë¦¬ ê³„ì‚° (cm)
  int distance = duration / 58;
  
  return distance;
}

/**
 * êµ¬ì—­ íŒì •
 */
Zone determineZone(int distance) {
  if (distance >= SAFE_DISTANCE) {
    return SAFE;
  } else if (distance >= WARN_DISTANCE) {
    return WARNING;
  } else {
    return DANGER;
  }
}

/**
 * LED ì—…ë°ì´íŠ¸
 */
void updateLED(int distance, Zone zone) {
  led.clear();
  
  int numLit = 0;
  uint32_t color = 0;
  
  switch (zone) {
    case SAFE:
      numLit = 8;
      color = led.Color(0, 255, 0);  // ì´ˆë¡
      break;
      
    case WARNING:
      numLit = map(distance, WARN_DISTANCE, SAFE_DISTANCE, 2, 6);
      color = led.Color(255, 255, 0);  // ë…¸ë‘
      break;
      
    case DANGER:
      numLit = 2;
      color = led.Color(255, 0, 0);  // ë¹¨ê°•
      // ê¹œë¹¡ì„ íš¨ê³¼
      if (millis() % 500 < 250) {
        numLit = 0;
      }
      break;
  }
  
  for (int i = 0; i < numLit; i++) {
    led.setPixelColor(i, color);
  }
  led.show();
}

/**
 * ë¶€ì € ì—…ë°ì´íŠ¸
 */
void updateBuzzer(Zone zone) {
  // êµ¬ì—­ë³„ ê°„ê²© ì„¤ì •
  switch (zone) {
    case SAFE:
      buzzerInterval = 2000;  // 2ì´ˆ
      break;
    case WARNING:
      buzzerInterval = 1000;  // 1ì´ˆ
      break;
    case DANGER:
      buzzerInterval = 300;   // 0.3ì´ˆ
      break;
  }
  
  // ê°„ê²©ë§ˆë‹¤ ì†Œë¦¬
  if (millis() - lastBuzzerTime >= buzzerInterval) {
    int frequency = (zone == DANGER) ? 2000 : 1000;
    int duration = (zone == DANGER) ? 100 : 50;
    tone(PIN_BUZZER, frequency, duration);
    lastBuzzerTime = millis();
  }
}

/**
 * LCD ì—…ë°ì´íŠ¸
 */
void updateLCD(int distance, Zone zone) {
  static int lastDistance = -1;
  static Zone lastZone = SAFE;
  
  // ë³€í™”ê°€ ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
  if (distance != lastDistance || zone != lastZone) {
    lcd.clear();
    
    // ì²« ì¤„: ê±°ë¦¬
    lcd.setCursor(0, 0);
    lcd.print("Distance: ");
    if (distance >= MAX_DISTANCE) {
      lcd.print("---");
    } else {
      lcd.print(distance);
      lcd.print("cm");
    }
    
    // ë‘˜ì§¸ ì¤„: ìƒíƒœ
    lcd.setCursor(0, 1);
    lcd.print("Status: ");
    switch (zone) {
      case SAFE:
        lcd.print("SAFE");
        break;
      case WARNING:
        lcd.print("WARNING");
        break;
      case DANGER:
        lcd.print("DANGER!");
        break;
    }
    
    lastDistance = distance;
    lastZone = zone;
  }
}

/**
 * Matrix ì—…ë°ì´íŠ¸
 */
void updateMatrix(Zone zone) {
  matrix.clearDisplay(0);
  
  byte* pattern;
  switch (zone) {
    case SAFE:
      pattern = arrowDown;
      break;
    case WARNING:
      pattern = arrowWarning;
      break;
    case DANGER:
      pattern = arrowStop;
      break;
  }
  
  for (int i = 0; i < 8; i++) {
    matrix.setRow(0, i, pattern[i]);
  }
}

/**
 * êµ¬ì—­ ë³€ê²½ ì•Œë¦¼ìŒ
 */
void playZoneChangeSound() {
  switch (currentZone) {
    case SAFE:
      tone(PIN_BUZZER, 523, 200);  // ë„
      break;
    case WARNING:
      tone(PIN_BUZZER, 659, 200);  // ë¯¸
      delay(250);
      tone(PIN_BUZZER, 659, 200);
      break;
    case DANGER:
      for (int i = 0; i < 3; i++) {
        tone(PIN_BUZZER, 1000, 100);
        delay(150);
      }
      break;
  }
}

/**
 * ìƒíƒœ ì¶œë ¥
 */
void printStatus(int distance, Zone zone) {
  static unsigned long lastPrint = 0;
  
  // 1ì´ˆë§ˆë‹¤ ì¶œë ¥
  if (millis() - lastPrint >= 1000) {
    Serial.print("Distance: ");
    Serial.print(distance);
    Serial.print("cm | Zone: ");
    
    switch (zone) {
      case SAFE:
        Serial.println("SAFE");
        break;
      case WARNING:
        Serial.println("WARNING");
        break;
      case DANGER:
        Serial.println("DANGER");
        break;
    }
    
    lastPrint = millis();
  }
}
```

---

## ğŸ® ì‚¬ìš© ë°©ë²•

### ê±°ë¦¬ë³„ ë™ì‘
- **50cm ì´ìƒ**: ì´ˆë¡ LED 8ê°œ, ë¶€ì € 2ì´ˆ ê°„ê²©
- **20-50cm**: ë…¸ë‘ LED 2-6ê°œ, ë¶€ì € 1ì´ˆ ê°„ê²©
- **20cm ë¯¸ë§Œ**: ë¹¨ê°• LED ê¹œë¹¡ì„, ë¶€ì € 0.3ì´ˆ ê°„ê²©

### í…ŒìŠ¤íŠ¸
1. ì´ˆìŒíŒŒ ì„¼ì„œ ì•ì— ì† ëŒ€ê¸°
2. ê±°ë¦¬ë¥¼ ë³€ê²½í•˜ë©° LED/ë¶€ì € í™•ì¸
3. LCDì— ê±°ë¦¬ í‘œì‹œ í™•ì¸

---

**ì‘ì„±ì¼**: 2026-01-27  
**ë‚œì´ë„**: â­â­â˜†â˜†â˜†  
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 1.5ì‹œê°„

