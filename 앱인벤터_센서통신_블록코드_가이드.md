# ì•±ì¸ë²¤í„° â†” ì•„ë‘ì´ë…¸ ì„¼ì„œ í†µì‹  ì™„ì „ ê°€ì´ë“œ

> **í”„ë¡œí† ì½œ ê·œì•½ + ì•„ë‘ì´ë…¸ ì†ŒìŠ¤ + ì•±ì¸ë²¤í„° ë¸”ë¡ + êµ¬ì¡°ë„ + í•µì‹¬ ì•Œê³ ë¦¬ì¦˜**

## ğŸ“Œ ê°œìš”

ì´ ë¬¸ì„œëŠ” **ì•±ì¸ë²¤í„°ì™€ ì•„ë‘ì´ë…¸ ê°„ ì„¼ì„œ ë°ì´í„° í†µì‹ **ì˜ ëª¨ë“  ê²ƒì„ ë‹¤ë£¹ë‹ˆë‹¤.

### êµ¬í˜„ ê¸°ëŠ¥
- âœ… ë¸”ë£¨íˆ¬ìŠ¤ ì–‘ë°©í–¥ í†µì‹ 
- âœ… ì„¼ì„œê°’ ìš”ì²­/ì‘ë‹µ (ë²„íŠ¼ + ìë™ 5ì´ˆ)
- âœ… ë°ì´í„° íŒŒì‹± ì•Œê³ ë¦¬ì¦˜
- âœ… ì œì–´ ëª…ë ¹ ì „ì†¡ (LED, ëª¨í„°, ì„œë³´)
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° ê²€ì¦
- âœ… ìƒ‰ìƒ ì„¼ì„œ ì˜ˆì‹œ (Red, Green, Blue)

---

## ğŸ“‚ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#1-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
2. [í”„ë¡œí† ì½œ í†µì‹  ê·œì•½](#2-í”„ë¡œí† ì½œ-í†µì‹ -ê·œì•½)
3. [ì•„ë‘ì´ë…¸ êµ¬í˜„](#3-ì•„ë‘ì´ë…¸-êµ¬í˜„)
4. [ì•±ì¸ë²¤í„° êµ¬í˜„](#4-ì•±ì¸ë²¤í„°-êµ¬í˜„)
5. [í•µì‹¬ ì•Œê³ ë¦¬ì¦˜](#5-í•µì‹¬-ì•Œê³ ë¦¬ì¦˜)
6. [ë°ì´í„° íë¦„ë„](#6-ë°ì´í„°-íë¦„ë„)
7. [ì‹¤ì „ ì˜ˆì œ](#7-ì‹¤ì „-ì˜ˆì œ)
8. [ë¬¸ì œ í•´ê²°](#8-ë¬¸ì œ-í•´ê²°)

---

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 1.1 ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“± ì•±ì¸ë²¤í„° (Android)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer                                                    â”‚
â”‚  â”œâ”€ Button (ì„¼ì„œê°’ ì½ê¸°)                                     â”‚
â”‚  â”œâ”€ CheckBox (ìë™ ê°±ì‹  5ì´ˆ)                                 â”‚
â”‚  â””â”€ Label, Canvas (ë°ì´í„° í‘œì‹œ)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Business Logic Layer                                        â”‚
â”‚  â”œâ”€ parseSensorData()      â† ë°ì´í„° íŒŒì‹± ì•Œê³ ë¦¬ì¦˜            â”‚
â”‚  â”œâ”€ extractSensorValues()  â† ê°’ ì¶”ì¶œ ë° ê²€ì¦                â”‚
â”‚  â”œâ”€ updateDisplay()        â† UI ê°±ì‹                          â”‚
â”‚  â””â”€ sendCommand()          â† ì œì–´ ëª…ë ¹ ìƒì„±                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Communication Layer                                         â”‚
â”‚  â”œâ”€ BluetoothClient1.SendText()      â† ëª…ë ¹ ì „ì†¡             â”‚
â”‚  â””â”€ BluetoothClient1.ReceiveText()   â† ë°ì´í„° ìˆ˜ì‹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
                    ğŸ”µ ë¸”ë£¨íˆ¬ìŠ¤ í†µì‹  (HC-05/06)
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¤– ì•„ë‘ì´ë…¸ (ATmega328P)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Communication Layer                                         â”‚
â”‚  â”œâ”€ receiveBluetoothData()  â† ë°ì´í„° ìˆ˜ì‹  ë²„í¼ë§             â”‚
â”‚  â””â”€ BTSerial.print()        â† ì‘ë‹µ ì „ì†¡                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Protocol Layer                                              â”‚
â”‚  â”œâ”€ processCommand()        â† ëª…ë ¹ íŒŒì‹±                      â”‚
â”‚  â”œâ”€ handleRequest()         â† ìš”ì²­ ì²˜ë¦¬                      â”‚
â”‚  â””â”€ handleControlCommand()  â† ì œì–´ ì²˜ë¦¬                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Hardware Abstraction Layer                                  â”‚
â”‚  â”œâ”€ readColorSensor()       â† ì„¼ì„œ ì½ê¸°                      â”‚
â”‚  â”œâ”€ setRGBLed()            â† LED ì œì–´                        â”‚
â”‚  â”œâ”€ setMotor()             â† ëª¨í„° ì œì–´                       â”‚
â”‚  â””â”€ setServoAngle()        â† ì„œë³´ ì œì–´                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Hardware Layer                                              â”‚
â”‚  â”œâ”€ TCS34725 ìƒ‰ìƒ ì„¼ì„œ                                       â”‚
â”‚  â”œâ”€ RGB LED                                                  â”‚
â”‚  â”œâ”€ DC ëª¨í„°                                                  â”‚
â”‚  â””â”€ ì„œë³´ ëª¨í„°                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 í†µì‹  ë ˆì´ì–´ ìƒì„¸

```
ì•±ì¸ë²¤í„°                      ë¸”ë£¨íˆ¬ìŠ¤                     ì•„ë‘ì´ë…¸
â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€
[Button Click]                                          
    â”‚                                                    
    â”œâ”€â†’ SendText("REQ:COLOR_") â”€â”€â†’ HC-05 TXD â”€â”€â†’ D10 RX â”€â”€â†’ [receiveBluetoothData()]
    â”‚                                                         â”‚
    â”‚                                                         â”œâ”€â†’ [processCommand()]
    â”‚                                                         â”‚     â”‚
    â”‚                                                         â”‚     â”œâ”€â†’ [handleRequest()]
    â”‚                                                         â”‚     â”‚     â”‚
    â”‚                                                         â”‚     â”‚     â”œâ”€â†’ [readColorSensor()]
    â”‚                                                         â”‚     â”‚     â”‚     â†’ TCS34725.getRawData()
    â”‚                                                         â”‚     â”‚     â”‚
    â”‚                                                         â”‚     â”‚     â””â”€â†’ [sendColorData()]
    â”‚                                                         â”‚     â”‚           â†’ "SENSOR:255,128,64_"
    â”‚                                                         â”‚     â”‚
    â”‚   [DataReceived]  â†â”€â”€ HC-05 RXD â†â”€â”€ D11 TX â†â”€â”€ BTSerial.print() â†â”€â”˜
    â”‚        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â†’ ReceiveText(-1)
    â”‚              â”‚
    â”‚              â”œâ”€â†’ [parseSensorData()]
    â”‚              â”‚     â”‚
    â”‚              â”‚     â”œâ”€â†’ "SENSOR:" ì œê±°
    â”‚              â”‚     â”œâ”€â†’ "_" ì œê±°
    â”‚              â”‚     â”œâ”€â†’ split(",")
    â”‚              â”‚     â””â”€â†’ [255, 128, 64]
    â”‚              â”‚
    â”‚              â””â”€â†’ [extractSensorValues()]
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ redValue = 255
    â”‚                    â”œâ”€â†’ greenValue = 128
    â”‚                    â””â”€â†’ blueValue = 64
    â”‚
    â””â”€â†’ [updateDisplay()]
          â”‚
          â”œâ”€â†’ Label_Red.Text = "ë¹¨ê°•: 255"
          â”œâ”€â†’ Label_Green.Text = "ì´ˆë¡: 128"
          â”œâ”€â†’ Label_Blue.Text = "íŒŒë‘: 64"
          â””â”€â†’ Canvas.BackgroundColor = RGB(255,128,64)
```

---

## 2. í”„ë¡œí† ì½œ í†µì‹  ê·œì•½

### 2.1 ë©”ì‹œì§€ êµ¬ì¡° (BNF í‘œê¸°ë²•)

```bnf
<message>     ::= <header> ":" <payload> "_"
<header>      ::= "REQ" | "CMD" | "SENSOR" | "ACK" | "ERROR" | "STATUS"
<payload>     ::= <request> | <command> | <sensor_data> | <status_data>

<request>     ::= "COLOR" | "STATUS" | "ALL"
<command>     ::= <led_cmd> | <motor_cmd> | <servo_cmd> | "RESET"
<led_cmd>     ::= "LED," <rgb_value>
<motor_cmd>   ::= "MOTOR_ON" | "MOTOR_OFF"
<servo_cmd>   ::= "SERVO," <angle>

<sensor_data> ::= <rgb_value>
<rgb_value>   ::= <number> "," <number> "," <number>
<angle>       ::= <number>
<number>      ::= [0-9]+
```

### 2.2 í”„ë¡œí† ì½œ ê·œì¹™

#### **í•µì‹¬ ê·œì¹™**

| ê·œì¹™ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **1. ì¢…ë£Œ ë¬¸ì** | ëª¨ë“  ë©”ì‹œì§€ëŠ” `_`ë¡œ ëë‚¨ | `SENSOR:255,128,64_` |
| **2. êµ¬ë¶„ì** | ë°ì´í„°ëŠ” `,`ë¡œ êµ¬ë¶„ | `255,128,64` |
| **3. í—¤ë”** | `:` ì•ì´ ë©”ì‹œì§€ íƒ€ì… | `SENSOR:` |
| **4. ëŒ€ì†Œë¬¸ì** | í—¤ë”ëŠ” ëŒ€ë¬¸ìë§Œ ì‚¬ìš© | `REQ:` (O), `req:` (X) |
| **5. ê³µë°± ê¸ˆì§€** | ê³µë°± ë¬¸ì í¬í•¨ ì•ˆ ë¨ | `REQ: COLOR_` (X) |
| **6. ê¸¸ì´ ì œí•œ** | ìµœëŒ€ 64ë°”ì´íŠ¸ | - |

#### **ë©”ì‹œì§€ íƒ€ì…ë³„ í˜•ì‹**

**ìš”ì²­ (ì•±ì¸ë²¤í„° â†’ ì•„ë‘ì´ë…¸)**

```
REQ:COLOR_          â†’ ìƒ‰ìƒ ì„¼ì„œê°’ ìš”ì²­
REQ:STATUS_         â†’ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì²­
REQ:ALL_            â†’ ëª¨ë“  ë°ì´í„° ìš”ì²­

CMD:LED,255,0,0_    â†’ LED ë¹¨ê°• (R,G,B)
CMD:MOTOR_ON_       â†’ ëª¨í„° ì¼œê¸°
CMD:MOTOR_OFF_      â†’ ëª¨í„° ë„ê¸°
CMD:SERVO,90_       â†’ ì„œë³´ 90ë„
CMD:RESET_          â†’ ì‹œìŠ¤í…œ ë¦¬ì…‹
```

**ì‘ë‹µ (ì•„ë‘ì´ë…¸ â†’ ì•±ì¸ë²¤í„°)**

```
SENSOR:255,128,64_      â†’ ì„¼ì„œ ë°ì´í„° (R,G,B)
STATUS:1,90_            â†’ ì‹œìŠ¤í…œ ìƒíƒœ (ëª¨í„°ìƒíƒœ, ì„œë³´ê°ë„)
ACK:OK_                 â†’ ëª…ë ¹ ìˆ˜ì‹  í™•ì¸
ERROR:100_              â†’ ì—ëŸ¬ ì½”ë“œ
READY_                  â†’ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ
```

### 2.3 ì—ëŸ¬ ì½”ë“œ ì •ì˜

| ì½”ë“œ | ì˜ë¯¸ | ì›ì¸ | ëŒ€ì‘ |
|------|------|------|------|
| **100** | ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ | í—¤ë” ì˜¤ë¥˜ | ëª…ë ¹ í˜•ì‹ í™•ì¸ |
| **101** | ì•Œ ìˆ˜ ì—†ëŠ” ìš”ì²­ íƒ€ì… | REQ: ë’¤ ì˜¤ë¥˜ | COLOR/STATUS/ALL í™•ì¸ |
| **102** | ì•Œ ìˆ˜ ì—†ëŠ” ì œì–´ ëª…ë ¹ | CMD: ë’¤ ì˜¤ë¥˜ | ì œì–´ ëª…ë ¹ í™•ì¸ |
| **103** | LED ëª…ë ¹ í˜•ì‹ ì˜¤ë¥˜ | RGB ê°œìˆ˜ ì˜¤ë¥˜ | 3ê°œ ê°’ í™•ì¸ |
| **104** | ì„œë³´ ëª…ë ¹ í˜•ì‹ ì˜¤ë¥˜ | ê°ë„ ëˆ„ë½ | 0-180 ë²”ìœ„ |
| **200** | ì„¼ì„œ ì½ê¸° ì‹¤íŒ¨ | í•˜ë“œì›¨ì–´ ì˜¤ë¥˜ | ì„¼ì„œ ì—°ê²° í™•ì¸ |
| **201** | ì•¡ì¶”ì—ì´í„° ì œì–´ ì‹¤íŒ¨ | í•˜ë“œì›¨ì–´ ì˜¤ë¥˜ | ë°°ì„  í™•ì¸ |

---

## 3. ì•„ë‘ì´ë…¸ êµ¬í˜„

### 3.1 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: ë°ì´í„° ìˆ˜ì‹  ë²„í¼ë§

```cpp
/*
 * ====================================================================
 * ì•Œê³ ë¦¬ì¦˜ 1: ë¸”ë£¨íˆ¬ìŠ¤ ë°ì´í„° ìˆ˜ì‹  ë²„í¼ë§
 * ëª©ì : ì¢…ë£Œ ë¬¸ì(_)ê¹Œì§€ ë°ì´í„° ëˆ„ì í•˜ì—¬ ì™„ì „í•œ ë©”ì‹œì§€ë§Œ ì²˜ë¦¬
 * ====================================================================
 */

// ì „ì—­ ë³€ìˆ˜
String receivedData = "";      // ìˆ˜ì‹  ë²„í¼
bool dataComplete = false;     // ì™„ì „í•œ ë©”ì‹œì§€ ìˆ˜ì‹  í”Œë˜ê·¸

// ë©”ì¸ ë£¨í”„ì—ì„œ í˜¸ì¶œ
void loop() {
  receiveBluetoothData();
  
  if (dataComplete) {
    processCommand(receivedData);
    receivedData = "";
    dataComplete = false;
  }
}

// ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
void receiveBluetoothData() {
  while (BTSerial.available()) {
    char inChar = (char)BTSerial.read();
    
    // ì¢…ë£Œ ë¬¸ì í™•ì¸
    if (inChar == '_') {
      dataComplete = true;
      break;  // ë” ì´ìƒ ì½ì§€ ì•ŠìŒ
    }
    
    // ë²„í¼ì— ì¶”ê°€
    receivedData += inChar;
    
    // ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ë°©ì§€
    if (receivedData.length() > 64) {
      receivedData = "";
      sendError(100);
      break;
    }
  }
}

/*
 * íë¦„ë„:
 * 
 * [ì‹œì‘]
 *    â†“
 * [ë°ì´í„° ìˆìŒ?] â”€Noâ†’ [ì¢…ë£Œ]
 *    â†“ Yes
 * [1ë°”ì´íŠ¸ ì½ê¸°]
 *    â†“
 * [ì¢…ë£Œ ë¬¸ì(_)?] â”€Yesâ†’ [dataComplete = true] â†’ [ì¢…ë£Œ]
 *    â†“ No
 * [ë²„í¼ì— ì¶”ê°€]
 *    â†“
 * [ê¸¸ì´ > 64?] â”€Yesâ†’ [ì—ëŸ¬ ì²˜ë¦¬] â†’ [ì¢…ë£Œ]
 *    â†“ No
 * [ë£¨í”„ ë°˜ë³µ]
 */
```

### 3.2 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: ëª…ë ¹ íŒŒì‹±

```cpp
/*
 * ====================================================================
 * ì•Œê³ ë¦¬ì¦˜ 2: ëª…ë ¹ íŒŒì‹± (ìƒíƒœ ê¸°ê³„ ë°©ì‹)
 * ëª©ì : ìˆ˜ì‹ ëœ ë¬¸ìì—´ì„ í”„ë¡œí† ì½œì— ë”°ë¼ ë¶„í•´
 * ====================================================================
 */

void processCommand(String cmd) {
  // Step 1: ê³µë°± ì œê±°
  cmd.trim();
  
  // Step 2: ë¹ˆ ëª…ë ¹ ì²´í¬
  if (cmd.length() == 0) {
    sendError(100);
    return;
  }
  
  // Step 3: í—¤ë” ì¶”ì¶œ (ì½œë¡  ì•ê¹Œì§€)
  int colonIndex = cmd.indexOf(':');
  if (colonIndex == -1) {
    sendError(100);  // í—¤ë” ì—†ìŒ
    return;
  }
  
  String header = cmd.substring(0, colonIndex);
  String payload = cmd.substring(colonIndex + 1);
  
  // Step 4: í—¤ë”ì— ë”°ë¥¸ ë¶„ê¸° (ìƒíƒœ ê¸°ê³„)
  if (header == "REQ") {
    handleRequest(payload);
  } 
  else if (header == "CMD") {
    handleControlCommand(payload);
  } 
  else {
    sendError(100);  // ì•Œ ìˆ˜ ì—†ëŠ” í—¤ë”
  }
}

/*
 * ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨:
 * 
 *           [ìˆ˜ì‹  ì™„ë£Œ]
 *                â†“
 *          [ê³µë°± ì œê±°]
 *                â†“
 *          [ê¸¸ì´ í™•ì¸] â”€â”€0â†’ ERROR:100
 *                â†“
 *          [ì½œë¡  ì°¾ê¸°] â”€â”€ì—†ìŒâ†’ ERROR:100
 *                â†“
 *          [í—¤ë” ë¶„ë¦¬]
 *                â†“
 *      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *      â†“                   â†“
 *   [REQ:]             [CMD:]
 *      â†“                   â†“
 * handleRequest()  handleControlCommand()
 */
```

### 3.3 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: ì„¼ì„œ ë°ì´í„° ì „ì†¡

```cpp
/*
 * ====================================================================
 * ì•Œê³ ë¦¬ì¦˜ 3: ì„¼ì„œ ë°ì´í„° ì½ê¸° ë° í”„ë¡œí† ì½œ ë©”ì‹œì§€ ìƒì„±
 * ëª©ì : RGB ì„¼ì„œê°’ì„ ì½ê³  í”„ë¡œí† ì½œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
 * ====================================================================
 */

void sendColorData() {
  // Step 1: ì„¼ì„œ ê°’ ì½ê¸°
  uint16_t red, green, blue, clear;
  
  #if USE_REAL_SENSOR
    colorSensor.getRawData(&red, &green, &blue, &clear);
    
    // Step 2: ì •ê·œí™” (16ë¹„íŠ¸ â†’ 8ë¹„íŠ¸)
    uint8_t r = map(red, 0, 65535, 0, 255);
    uint8_t g = map(green, 0, 65535, 0, 255);
    uint8_t b = map(blue, 0, 65535, 0, 255);
  #else
    // ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ (ì•„ë‚ ë¡œê·¸ í•€)
    uint8_t r = map(analogRead(A0), 0, 1023, 0, 255);
    uint8_t g = map(analogRead(A1), 0, 1023, 0, 255);
    uint8_t b = map(analogRead(A2), 0, 1023, 0, 255);
  #endif
  
  // Step 3: í”„ë¡œí† ì½œ ë©”ì‹œì§€ ìƒì„±
  String message = "SENSOR:";
  message += String(r);
  message += ",";
  message += String(g);
  message += ",";
  message += String(b);
  message += "_";
  
  // Step 4: ì „ì†¡
  BTSerial.print(message);
  
  // Step 5: ë””ë²„ê·¸ ì¶œë ¥ (ì˜µì…˜)
  #if ENABLE_DEBUG
    Serial.println("[ì „ì†¡] " + message);
  #endif
}

/*
 * ë°ì´í„° íë¦„:
 * 
 * [ì„¼ì„œ í•˜ë“œì›¨ì–´]
 *       â†“ (I2C í†µì‹ )
 * [getRawData()]
 *       â†“ (16ë¹„íŠ¸ ê°’: 0-65535)
 * [ì •ê·œí™”: map()]
 *       â†“ (8ë¹„íŠ¸ ê°’: 0-255)
 * [ë¬¸ìì—´ ë³€í™˜]
 *       â†“ ("255", "128", "64")
 * [í”„ë¡œí† ì½œ ì¡°ë¦½]
 *       â†“ ("SENSOR:255,128,64_")
 * [ë¸”ë£¨íˆ¬ìŠ¤ ì „ì†¡]
 *       â†“
 * [ì•±ì¸ë²¤í„° ìˆ˜ì‹ ]
 */
```

### 3.4 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: LED ëª…ë ¹ íŒŒì‹±

```cpp
/*
 * ====================================================================
 * ì•Œê³ ë¦¬ì¦˜ 4: LED ëª…ë ¹ íŒŒì‹± (ë¬¸ìì—´ í† í¬ë‚˜ì´ì§•)
 * ëª©ì : "LED,255,0,0" í˜•ì‹ì„ RGB ê°’ìœ¼ë¡œ ë¶„í•´
 * ====================================================================
 */

void parseLedCommand(String cmd) {
  // í˜•ì‹: LED,R,G,B
  // ì˜ˆ: LED,255,0,0
  
  // Step 1: ì‰¼í‘œ ìœ„ì¹˜ ì°¾ê¸°
  int firstComma = cmd.indexOf(',');
  int secondComma = cmd.indexOf(',', firstComma + 1);
  int thirdComma = cmd.indexOf(',', secondComma + 1);
  
  // Step 2: í˜•ì‹ ê²€ì¦
  if (firstComma == -1 || secondComma == -1) {
    sendError(103);  // LED ëª…ë ¹ í˜•ì‹ ì˜¤ë¥˜
    return;
  }
  
  // Step 3: ê° ê°’ ì¶”ì¶œ
  String rStr = cmd.substring(firstComma + 1, secondComma);
  String gStr = cmd.substring(secondComma + 1, 
                               thirdComma != -1 ? thirdComma : cmd.length());
  String bStr = thirdComma != -1 ? cmd.substring(thirdComma + 1) : "0";
  
  // Step 4: ì •ìˆ˜ ë³€í™˜
  int r = rStr.toInt();
  int g = gStr.toInt();
  int b = bStr.toInt();
  
  // Step 5: ë²”ìœ„ ê²€ì¦ (0-255)
  r = constrain(r, 0, 255);
  g = constrain(g, 0, 255);
  b = constrain(b, 0, 255);
  
  // Step 6: í•˜ë“œì›¨ì–´ ì œì–´
  setRGBLed(r, g, b);
  
  // Step 7: í™•ì¸ ì‘ë‹µ
  sendAck();
}

/*
 * íŒŒì‹± ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™”:
 * 
 * ì…ë ¥: "LED,255,128,64"
 *          â†“
 *    [indexOf(',')]
 *          â†“
 * firstComma = 3
 *          â†“
 *    [indexOf(',', 4)]
 *          â†“
 * secondComma = 7
 *          â†“
 *    [indexOf(',', 8)]
 *          â†“
 * thirdComma = 11
 *          â†“
 *    [substring()]
 *          â†“
 * rStr = "255"
 * gStr = "128"
 * bStr = "64"
 *          â†“
 *    [toInt()]
 *          â†“
 * r = 255, g = 128, b = 64
 */
```

### 3.5 ì™„ì „í•œ ì•„ë‘ì´ë…¸ ì½”ë“œ (í•µì‹¬ ë¶€ë¶„)

```cpp
// ==================== ì „ì—­ ë³€ìˆ˜ ====================
String receivedData = "";
bool dataComplete = false;

uint8_t sensorRed = 0;
uint8_t sensorGreen = 0;
uint8_t sensorBlue = 0;

// ==================== ë©”ì¸ ë£¨í”„ ====================
void loop() {
  // ì•Œê³ ë¦¬ì¦˜ 1: ë°ì´í„° ìˆ˜ì‹ 
  receiveBluetoothData();
  
  // ì•Œê³ ë¦¬ì¦˜ 2: ëª…ë ¹ ì²˜ë¦¬
  if (dataComplete) {
    processCommand(receivedData);
    receivedData = "";
    dataComplete = false;
  }
}

// ==================== ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ ====================

// [ì•Œê³ ë¦¬ì¦˜ 1] ë¸”ë£¨íˆ¬ìŠ¤ ë°ì´í„° ìˆ˜ì‹  ë²„í¼ë§
void receiveBluetoothData() {
  while (BTSerial.available()) {
    char inChar = (char)BTSerial.read();
    
    if (inChar == '_') {
      dataComplete = true;
      break;
    }
    
    receivedData += inChar;
    
    if (receivedData.length() > 64) {
      receivedData = "";
      sendError(100);
      break;
    }
  }
}

// [ì•Œê³ ë¦¬ì¦˜ 2] ëª…ë ¹ íŒŒì‹± (ìƒíƒœ ê¸°ê³„)
void processCommand(String cmd) {
  cmd.trim();
  
  if (cmd.length() == 0) {
    sendError(100);
    return;
  }
  
  int colonIndex = cmd.indexOf(':');
  if (colonIndex == -1) {
    sendError(100);
    return;
  }
  
  String header = cmd.substring(0, colonIndex);
  String payload = cmd.substring(colonIndex + 1);
  
  if (header == "REQ") {
    handleRequest(payload);
  } 
  else if (header == "CMD") {
    handleControlCommand(payload);
  } 
  else {
    sendError(100);
  }
}

// ìš”ì²­ ì²˜ë¦¬
void handleRequest(String reqType) {
  if (reqType == "COLOR") {
    sendColorData();  // [ì•Œê³ ë¦¬ì¦˜ 3]
  } 
  else if (reqType == "STATUS") {
    sendSystemStatus();
  } 
  else {
    sendError(101);
  }
}

// ì œì–´ ëª…ë ¹ ì²˜ë¦¬
void handleControlCommand(String ctrlCmd) {
  if (ctrlCmd.startsWith("LED,")) {
    parseLedCommand(ctrlCmd);  // [ì•Œê³ ë¦¬ì¦˜ 4]
  } 
  else if (ctrlCmd == "MOTOR_ON") {
    setMotor(true);
    sendAck();
  } 
  else if (ctrlCmd == "MOTOR_OFF") {
    setMotor(false);
    sendAck();
  } 
  else {
    sendError(102);
  }
}

// [ì•Œê³ ë¦¬ì¦˜ 3] ì„¼ì„œ ë°ì´í„° ì „ì†¡
void sendColorData() {
  readColorSensor();
  
  String message = "SENSOR:";
  message += String(sensorRed);
  message += ",";
  message += String(sensorGreen);
  message += ",";
  message += String(sensorBlue);
  message += "_";
  
  BTSerial.print(message);
}

// [ì•Œê³ ë¦¬ì¦˜ 4] LED ëª…ë ¹ íŒŒì‹±
void parseLedCommand(String cmd) {
  int firstComma = cmd.indexOf(',');
  int secondComma = cmd.indexOf(',', firstComma + 1);
  int thirdComma = cmd.indexOf(',', secondComma + 1);
  
  if (firstComma == -1 || secondComma == -1) {
    sendError(103);
    return;
  }
  
  int r = cmd.substring(firstComma + 1, secondComma).toInt();
  int g = cmd.substring(secondComma + 1, thirdComma != -1 ? thirdComma : cmd.length()).toInt();
  int b = thirdComma != -1 ? cmd.substring(thirdComma + 1).toInt() : 0;
  
  r = constrain(r, 0, 255);
  g = constrain(g, 0, 255);
  b = constrain(b, 0, 255);
  
  setRGBLed(r, g, b);
  sendAck();
}

// ì‘ë‹µ ì „ì†¡
void sendAck() {
  BTSerial.print("ACK:OK_");
}

void sendError(int errorCode) {
  BTSerial.print("ERROR:");
  BTSerial.print(errorCode);
  BTSerial.print("_");
}
```

---

## 4. ì•±ì¸ë²¤í„° êµ¬í˜„

### 4.1 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: ë°ì´í„° íŒŒì‹±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì•Œê³ ë¦¬ì¦˜: parseSensorData                                     â”‚
â”‚ ì…ë ¥: "SENSOR:255,128,64_"                                    â”‚
â”‚ ì¶œë ¥: redValue=255, greenValue=128, blueValue=64             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ procedure parseSensorData (data)                             â”‚
â”‚                                                               â”‚
â”‚ Step 1: ì¢…ë£Œ ë¬¸ì ì œê±°                                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   cleanData = replace all (data, "_", "")                    â”‚
â”‚   â†’ "SENSOR:255,128,64"                                      â”‚
â”‚                                                               â”‚
â”‚ Step 2: í—¤ë” ì œê±°                                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚   dataOnly = replace all (cleanData, "SENSOR:", "")          â”‚
â”‚   â†’ "255,128,64"                                             â”‚
â”‚                                                               â”‚
â”‚ Step 3: ì‰¼í‘œë¡œ ë¶„ë¦¬                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚   SENSOR_List = split (dataOnly, ",")                        â”‚
â”‚   â†’ ["255", "128", "64"]                                     â”‚
â”‚                                                               â”‚
â”‚ Step 4: ê¸¸ì´ ê²€ì¦                                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚   if length of SENSOR_List = 3                              â”‚
â”‚   then                                                        â”‚
â”‚     extractSensorValues()  â† ë‹¤ìŒ ì•Œê³ ë¦¬ì¦˜ í˜¸ì¶œ              â”‚
â”‚     updateDisplay()                                          â”‚
â”‚   else                                                        â”‚
â”‚     ShowToast("ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜")                            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íë¦„ë„:

   [ìˆ˜ì‹ : "SENSOR:255,128,64_"]
           â†“
   [replace all: "_" â†’ ""]
           â†“
   ["SENSOR:255,128,64"]
           â†“
   [replace all: "SENSOR:" â†’ ""]
           â†“
   ["255,128,64"]
           â†“
   [split at: ","]
           â†“
   [["255", "128", "64"]]
           â†“
   [length = 3?] â”€Noâ†’ [ì—ëŸ¬ ì²˜ë¦¬]
           â†“ Yes
   [extractSensorValues()]
           â†“
   [updateDisplay()]
```

### 4.2 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: ì„¼ì„œ ê°’ ì¶”ì¶œ ë° ê²€ì¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì•Œê³ ë¦¬ì¦˜: extractSensorValues                                 â”‚
â”‚ ì…ë ¥: SENSOR_List = ["255", "128", "64"]                     â”‚
â”‚ ì¶œë ¥: ì „ì—­ ë³€ìˆ˜ì— ê²€ì¦ëœ ê°’ ì €ì¥                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ procedure extractSensorValues                                â”‚
â”‚                                                               â”‚
â”‚ Step 1: ë¦¬ìŠ¤íŠ¸ì—ì„œ ê°’ ì¶”ì¶œ                                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚   redValue = select list item (SENSOR_List, index: 1)       â”‚
â”‚   â†’ "255" (ë¬¸ìì—´)                                           â”‚
â”‚                                                               â”‚
â”‚   greenValue = select list item (SENSOR_List, index: 2)     â”‚
â”‚   â†’ "128"                                                    â”‚
â”‚                                                               â”‚
â”‚   blueValue = select list item (SENSOR_List, index: 3)      â”‚
â”‚   â†’ "64"                                                     â”‚
â”‚                                                               â”‚
â”‚ Step 2: ë²”ìœ„ ê²€ì¦ (0-255)                                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   if or (redValue < 0, redValue > 255)                      â”‚
â”‚   then                                                        â”‚
â”‚     redValue = 0  â† ê¸°ë³¸ê°’ ì„¤ì •                              â”‚
â”‚                                                               â”‚
â”‚   if or (greenValue < 0, greenValue > 255)                  â”‚
â”‚   then                                                        â”‚
â”‚     greenValue = 0                                           â”‚
â”‚                                                               â”‚
â”‚   if or (blueValue < 0, blueValue > 255)                    â”‚
â”‚   then                                                        â”‚
â”‚     blueValue = 0                                            â”‚
â”‚                                                               â”‚
â”‚ Step 3: íƒ€ì… ë³€í™˜ (ì•±ì¸ë²¤í„°ëŠ” ìë™)                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚   ë¬¸ìì—´ "255" â†’ ìˆ«ì 255                                    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê²€ì¦ íë¦„ë„:

   [ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ]
           â†“
   [redValue = "255"]
           â†“
   [< 0?] â”€Yesâ†’ [redValue = 0]
           â†“ No
   [> 255?] â”€Yesâ†’ [redValue = 0]
           â†“ No
   [ìœ íš¨í•œ ê°’: 255]
           â†“
   [ì „ì—­ ë³€ìˆ˜ ì €ì¥]
```

### 4.3 í•µì‹¬ ì•Œê³ ë¦¬ì¦˜: ìë™ ê°±ì‹  (Clock 5ì´ˆ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì•Œê³ ë¦¬ì¦˜: ìë™ ì„¼ì„œê°’ ê°±ì‹  (5ì´ˆ ì£¼ê¸°)                         â”‚
â”‚ ì‚¬ìš©: Clock ì»´í¬ë„ŒíŠ¸ + CheckBox                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ [Clock_AutoUpdate ì„¤ì •]                                      â”‚
â”‚   TimerInterval: 5000 (5ì´ˆ = 5000ms)                        â”‚
â”‚   TimerEnabled: false (ì´ˆê¸°ê°’)                               â”‚
â”‚                                                               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ when CheckBox_Auto.Changed                                   â”‚
â”‚ do                                                            â”‚
â”‚   if CheckBox_Auto.Checked                                   â”‚
â”‚   then                                                        â”‚
â”‚     // ìë™ ê°±ì‹  í™œì„±í™” ì¡°ê±´ í™•ì¸                            â”‚
â”‚     if isConnected = true                                    â”‚
â”‚     then                                                      â”‚
â”‚       set Clock_AutoUpdate.TimerEnabled to true              â”‚
â”‚       set Label_Status.Text to "ìë™ ê°±ì‹  í™œì„±í™” (5ì´ˆ)"      â”‚
â”‚     else                                                      â”‚
â”‚       // ì—°ê²° ì•ˆ ë¨ â†’ CheckBox ê°•ì œ í•´ì œ                     â”‚
â”‚       set CheckBox_Auto.Checked to false                     â”‚
â”‚       call Notifier1.ShowAlert                               â”‚
â”‚         notice: "ë¸”ë£¨íˆ¬ìŠ¤ë¥¼ ë¨¼ì € ì—°ê²°í•˜ì„¸ìš”"                 â”‚
â”‚   else                                                        â”‚
â”‚     // ìë™ ê°±ì‹  ë¹„í™œì„±í™”                                    â”‚
â”‚     set Clock_AutoUpdate.TimerEnabled to false               â”‚
â”‚     set Label_Status.Text to "ìë™ ê°±ì‹  ë¹„í™œì„±í™”"            â”‚
â”‚                                                               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ when Clock_AutoUpdate.Timer                                  â”‚
â”‚ do                                                            â”‚
â”‚   // ë§¤ 5ì´ˆë§ˆë‹¤ ìë™ ì‹¤í–‰                                    â”‚
â”‚   if isConnected = true                                      â”‚
â”‚   then                                                        â”‚
â”‚     // ì„¼ì„œê°’ ìš”ì²­                                           â”‚
â”‚     call BluetoothClient1.SendText                           â”‚
â”‚       text: "REQ:COLOR_"                                     â”‚
â”‚                                                               â”‚
â”‚     // ë””ë²„ê·¸ ì¶œë ¥ (ì˜µì…˜)                                    â”‚
â”‚     if debugMode = true                                      â”‚
â”‚     then                                                      â”‚
â”‚       set Label_Debug.Text to                                â”‚
â”‚         join "ìë™ ìš”ì²­: " Clock_AutoUpdate.Instant          â”‚
â”‚   else                                                        â”‚
â”‚     // ì—°ê²° ëŠê¹€ ê°ì§€ â†’ ìë™ ì¤‘ì§€                            â”‚
â”‚     set Clock_AutoUpdate.TimerEnabled to false               â”‚
â”‚     set CheckBox_Auto.Checked to false                       â”‚
â”‚     call Notifier1.ShowAlert                                 â”‚
â”‚       notice: "ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°ì´ ëŠê²¼ìŠµë‹ˆë‹¤"                   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨:

    [ì´ˆê¸° ìƒíƒœ: TimerEnabled=false]
               â†“
    [CheckBox í™œì„±í™”]
               â†“
       [ì—°ê²° ìƒíƒœ í™•ì¸]
          â”œâ”€ ì—°ê²°ë¨ â†’ [TimerEnabled=true]
          â”‚              â†“
          â”‚        [5ì´ˆ ëŒ€ê¸°]
          â”‚              â†“
          â”‚        [Timer ì´ë²¤íŠ¸]
          â”‚              â†“
          â”‚        [REQ:COLOR_ ì „ì†¡]
          â”‚              â†“
          â”‚        [5ì´ˆ ëŒ€ê¸°] â† ë°˜ë³µ
          â”‚
          â””â”€ ì—°ê²° ì•ˆë¨ â†’ [ì—ëŸ¬ ì•Œë¦¼]

    [CheckBox ë¹„í™œì„±í™”] â†’ [TimerEnabled=false]
```

---

## 5. í•µì‹¬ ì•Œê³ ë¦¬ì¦˜

### 5.1 ì•Œê³ ë¦¬ì¦˜ ìš”ì•½

| ì´ë¦„ | ìœ„ì¹˜ | ëª©ì  | ë³µì¡ë„ |
|------|------|------|--------|
| **ë°ì´í„° ìˆ˜ì‹  ë²„í¼ë§** | ì•„ë‘ì´ë…¸ | ì™„ì „í•œ ë©”ì‹œì§€ë§Œ ì²˜ë¦¬ | O(n) |
| **ëª…ë ¹ íŒŒì‹± (ìƒíƒœ ê¸°ê³„)** | ì•„ë‘ì´ë…¸ | í—¤ë”/í˜ì´ë¡œë“œ ë¶„ë¦¬ | O(1) |
| **ì„¼ì„œ ë°ì´í„° ì „ì†¡** | ì•„ë‘ì´ë…¸ | í”„ë¡œí† ì½œ ë©”ì‹œì§€ ìƒì„± | O(1) |
| **LED ëª…ë ¹ íŒŒì‹±** | ì•„ë‘ì´ë…¸ | ë¬¸ìì—´ í† í¬ë‚˜ì´ì§• | O(n) |
| **ë°ì´í„° íŒŒì‹±** | ì•±ì¸ë²¤í„° | ì„¼ì„œ ë°ì´í„° ì¶”ì¶œ | O(n) |
| **ì„¼ì„œ ê°’ ê²€ì¦** | ì•±ì¸ë²¤í„° | ë²”ìœ„ ì²´í¬ | O(1) |
| **ìë™ ê°±ì‹ ** | ì•±ì¸ë²¤í„° | ì£¼ê¸°ì  ìš”ì²­ | O(1) |

### 5.2 í†µì‹  ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

```
ì•±ì¸ë²¤í„°                ë¸”ë£¨íˆ¬ìŠ¤              ì•„ë‘ì´ë…¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€
[ë²„íŠ¼ í´ë¦­]
    â”‚
    â”œâ”€â†’ SendText("REQ:COLOR_") â”€â”€â”€â†’ HC-05 â”€â”€â”€â†’ [ìˆ˜ì‹  ë²„í¼]
    â”‚                                              â”‚
    â”‚                                              â”œâ”€â†’ '_' ê°ì§€
    â”‚                                              â”‚
    â”‚                                              â”œâ”€â†’ processCommand()
    â”‚                                              â”‚     â”‚
    â”‚                                              â”‚     â”œâ”€â†’ indexOf(':')
    â”‚                                              â”‚     â”‚     header = "REQ"
    â”‚                                              â”‚     â”‚     payload = "COLOR"
    â”‚                                              â”‚     â”‚
    â”‚                                              â”‚     â”œâ”€â†’ handleRequest()
    â”‚                                              â”‚     â”‚     â”‚
    â”‚                                              â”‚     â”‚     â”œâ”€â†’ readColorSensor()
    â”‚                                              â”‚     â”‚     â”‚     RGB = (255,128,64)
    â”‚                                              â”‚     â”‚     â”‚
    â”‚                                              â”‚     â”‚     â””â”€â†’ sendColorData()
    â”‚                                              â”‚     â”‚           "SENSOR:255,128,64_"
    â”‚                                              â”‚     â”‚
    â”‚   [DataReceived] â†â”€â”€â”€â”€â”€ HC-05 â†â”€â”€â”€â”€â”€ BTSerial.print() â†â”€â”˜
    â”‚        â”‚
    â”‚        â”œâ”€â†’ ReceiveText(-1)
    â”‚        â”‚     receivedText = "SENSOR:255,128,64_"
    â”‚        â”‚
    â”‚        â”œâ”€â†’ starts with "SENSOR:"? â†’ Yes
    â”‚        â”‚
    â”‚        â”œâ”€â†’ parseSensorData()
    â”‚        â”‚     â”‚
    â”‚        â”‚     â”œâ”€â†’ replace("_", "")
    â”‚        â”‚     â”‚     â†’ "SENSOR:255,128,64"
    â”‚        â”‚     â”‚
    â”‚        â”‚     â”œâ”€â†’ replace("SENSOR:", "")
    â”‚        â”‚     â”‚     â†’ "255,128,64"
    â”‚        â”‚     â”‚
    â”‚        â”‚     â”œâ”€â†’ split(",")
    â”‚        â”‚     â”‚     â†’ ["255", "128", "64"]
    â”‚        â”‚     â”‚
    â”‚        â”‚     â””â”€â†’ length = 3? â†’ Yes
    â”‚        â”‚
    â”‚        â”œâ”€â†’ extractSensorValues()
    â”‚        â”‚     â”‚
    â”‚        â”‚     â”œâ”€â†’ redValue = 255
    â”‚        â”‚     â”œâ”€â†’ greenValue = 128
    â”‚        â”‚     â””â”€â†’ blueValue = 64
    â”‚        â”‚
    â”‚        â””â”€â†’ updateDisplay()
    â”‚              â”‚
    â”‚              â”œâ”€â†’ Label_Red.Text = "ë¹¨ê°•: 255"
    â”‚              â”œâ”€â†’ Label_Green.Text = "ì´ˆë¡: 128"
    â”‚              â”œâ”€â†’ Label_Blue.Text = "íŒŒë‘: 64"
    â”‚              â””â”€â†’ Canvas.BackgroundColor = RGB(255,128,64)
    â”‚
[í™”ë©´ ê°±ì‹  ì™„ë£Œ]
```

### 5.3 ì—ëŸ¬ ì²˜ë¦¬ íë¦„ë„

```
                   [ë©”ì‹œì§€ ìˆ˜ì‹ ]
                        â†“
              [ì¢…ë£Œ ë¬¸ì(_) ìˆìŒ?]
                  â”œâ”€ Yes â†’ [ì •ìƒ]
                  â””â”€ No â†’ [ERROR:100]
                        â†“
                   [ê¸¸ì´ í™•ì¸]
                  â”œâ”€ â‰¤64 â†’ [ì •ìƒ]
                  â””â”€ >64 â†’ [ERROR:100]
                        â†“
                 [í—¤ë” ë¶„ë¦¬ (:)]
                  â”œâ”€ ì„±ê³µ â†’ [ì •ìƒ]
                  â””â”€ ì‹¤íŒ¨ â†’ [ERROR:100]
                        â†“
                  [í—¤ë” í™•ì¸]
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“        â†“        â†“
       [REQ:]  [CMD:]   [ê¸°íƒ€]
         â”‚        â”‚        â”‚
         â”‚        â”‚        â””â”€â†’ [ERROR:100]
         â”‚        â”‚
         â†“        â†“
    [ìš”ì²­ íƒ€ì…] [ì œì–´ íƒ€ì…]
      í™•ì¸       í™•ì¸
         â”‚        â”‚
   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“     â†“     â†“  â†“        â†“         â†“
[COLOR][STATUS][ê¸°íƒ€] [LED] [MOTOR] [ê¸°íƒ€]
   â”‚     â”‚     â”‚     â”‚      â”‚         â”‚
   â”‚     â”‚     â”‚     â”‚      â”‚         â””â”€â†’ [ERROR:102]
   â”‚     â”‚     â”‚     â”‚      â”‚
   â”‚     â”‚     â”‚     â”œâ”€â†’[RGB íŒŒì‹±]
   â”‚     â”‚     â”‚     â”‚    â”œâ”€ ì„±ê³µ â†’ [setRGBLed()]
   â”‚     â”‚     â”‚     â”‚    â””â”€ ì‹¤íŒ¨ â†’ [ERROR:103]
   â”‚     â”‚     â”‚     â”‚
   â”‚     â”‚     â””â”€â†’ [ERROR:101]
   â”‚     â”‚
   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â†’ [ì„¼ì„œ ì½ê¸°]
                    â”œâ”€ ì„±ê³µ â†’ [SENSOR:R,G,B_]
                    â””â”€ ì‹¤íŒ¨ â†’ [ERROR:200]
```

---

## 6. ë°ì´í„° íë¦„ë„

### 6.1 ì„¼ì„œ ë°ì´í„° ì½ê¸° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ë°ì´í„° ì½ê¸° íë¦„                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ì‚¬ìš©ì]
   â”‚
   â”œâ”€â†’ ë²„íŠ¼ í´ë¦­ / CheckBox í™œì„±í™”
   â”‚
   â†“
[ì•±ì¸ë²¤í„° UI Layer]
   â”‚
   â”œâ”€â†’ Button_ReadSensor.Click
   â”‚   ë˜ëŠ”
   â”‚   Clock_AutoUpdate.Timer (5ì´ˆë§ˆë‹¤)
   â”‚
   â†“
[ì•±ì¸ë²¤í„° Communication Layer]
   â”‚
   â”œâ”€â†’ BluetoothClient1.SendText("REQ:COLOR_")
   â”‚
   â†“
[ë¸”ë£¨íˆ¬ìŠ¤ í†µì‹ ]
   â”‚
   â”œâ”€â†’ HC-05 ëª¨ë“ˆ (ë¬´ì„  ì „ì†¡)
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Communication Layer]
   â”‚
   â”œâ”€â†’ receiveBluetoothData()
   â”‚   while (BTSerial.available())
   â”‚     char inChar = BTSerial.read()
   â”‚     if (inChar == '_') dataComplete = true
   â”‚     else receivedData += inChar
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Protocol Layer]
   â”‚
   â”œâ”€â†’ processCommand("REQ:COLOR")
   â”‚     â”‚
   â”‚     â”œâ”€â†’ indexOf(':') â†’ í—¤ë” ë¶„ë¦¬
   â”‚     â”‚   header = "REQ"
   â”‚     â”‚   payload = "COLOR"
   â”‚     â”‚
   â”‚     â””â”€â†’ handleRequest("COLOR")
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Hardware Abstraction Layer]
   â”‚
   â”œâ”€â†’ sendColorData()
   â”‚     â”‚
   â”‚     â”œâ”€â†’ readColorSensor()
   â”‚     â”‚     colorSensor.getRawData(&red, &green, &blue)
   â”‚     â”‚     r = map(red, 0, 65535, 0, 255)
   â”‚     â”‚     g = map(green, 0, 65535, 0, 255)
   â”‚     â”‚     b = map(blue, 0, 65535, 0, 255)
   â”‚     â”‚
   â”‚     â””â”€â†’ "SENSOR:255,128,64_" ìƒì„±
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Hardware Layer]
   â”‚
   â”œâ”€â†’ TCS34725 ì„¼ì„œ
   â”‚   I2C í†µì‹  â†’ RGB ê°’ ë°˜í™˜
   â”‚
   â†“
[ë¸”ë£¨íˆ¬ìŠ¤ í†µì‹ ]
   â”‚
   â”œâ”€â†’ BTSerial.print("SENSOR:255,128,64_")
   â”‚
   â†“
[ì•±ì¸ë²¤í„° Communication Layer]
   â”‚
   â”œâ”€â†’ BluetoothClient1.DataReceived
   â”‚     â”‚
   â”‚     â””â”€â†’ ReceiveText(-1)
   â”‚           receivedText = "SENSOR:255,128,64_"
   â”‚
   â†“
[ì•±ì¸ë²¤í„° Business Logic Layer]
   â”‚
   â”œâ”€â†’ parseSensorData(receivedText)
   â”‚     â”‚
   â”‚     â”œâ”€â†’ replace all ("_", "")
   â”‚     â”‚   â†’ "SENSOR:255,128,64"
   â”‚     â”‚
   â”‚     â”œâ”€â†’ replace all ("SENSOR:", "")
   â”‚     â”‚   â†’ "255,128,64"
   â”‚     â”‚
   â”‚     â”œâ”€â†’ split (",")
   â”‚     â”‚   â†’ ["255", "128", "64"]
   â”‚     â”‚
   â”‚     â””â”€â†’ extractSensorValues()
   â”‚           redValue = 255
   â”‚           greenValue = 128
   â”‚           blueValue = 64
   â”‚
   â†“
[ì•±ì¸ë²¤í„° UI Layer]
   â”‚
   â”œâ”€â†’ updateDisplay()
   â”‚     â”‚
   â”‚     â”œâ”€â†’ Label_Red.Text = "ë¹¨ê°•: 255"
   â”‚     â”œâ”€â†’ Label_Green.Text = "ì´ˆë¡: 128"
   â”‚     â”œâ”€â†’ Label_Blue.Text = "íŒŒë‘: 64"
   â”‚     â””â”€â†’ Canvas.BackgroundColor = RGB(255,128,64)
   â”‚
   â†“
[ì‚¬ìš©ì]
   â”‚
   â””â”€â†’ í™”ë©´ì—ì„œ ì„¼ì„œê°’ í™•ì¸
```

### 6.2 ì œì–´ ëª…ë ¹ ì „ì†¡ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì œì–´ ëª…ë ¹ íë¦„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ì‚¬ìš©ì]
   â”‚
   â”œâ”€â†’ LED ë¹¨ê°• ë²„íŠ¼ í´ë¦­
   â”‚
   â†“
[ì•±ì¸ë²¤í„° UI Layer]
   â”‚
   â”œâ”€â†’ Button_LED_Red.Click
   â”‚
   â†“
[ì•±ì¸ë²¤í„° Business Logic Layer]
   â”‚
   â”œâ”€â†’ isConnected í™•ì¸
   â”‚   if true â†’ ëª…ë ¹ ì „ì†¡
   â”‚   if false â†’ ì—ëŸ¬ ë©”ì‹œì§€
   â”‚
   â†“
[ì•±ì¸ë²¤í„° Communication Layer]
   â”‚
   â”œâ”€â†’ BluetoothClient1.SendText("CMD:LED,255,0,0_")
   â”‚
   â†“
[ë¸”ë£¨íˆ¬ìŠ¤ í†µì‹ ]
   â”‚
   â”œâ”€â†’ HC-05 ëª¨ë“ˆ (ë¬´ì„  ì „ì†¡)
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Communication Layer]
   â”‚
   â”œâ”€â†’ receiveBluetoothData()
   â”‚   receivedData = "CMD:LED,255,0,0"
   â”‚   dataComplete = true
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Protocol Layer]
   â”‚
   â”œâ”€â†’ processCommand("CMD:LED,255,0,0")
   â”‚     â”‚
   â”‚     â”œâ”€â†’ indexOf(':') â†’ í—¤ë” ë¶„ë¦¬
   â”‚     â”‚   header = "CMD"
   â”‚     â”‚   payload = "LED,255,0,0"
   â”‚     â”‚
   â”‚     â””â”€â†’ handleControlCommand("LED,255,0,0")
   â”‚           â”‚
   â”‚           â””â”€â†’ startsWith("LED,") â†’ true
   â”‚                 â”‚
   â”‚                 â””â”€â†’ parseLedCommand("LED,255,0,0")
   â”‚
   â†“
[LED ëª…ë ¹ íŒŒì‹± ì•Œê³ ë¦¬ì¦˜]
   â”‚
   â”œâ”€â†’ indexOf(',') â†’ ì‰¼í‘œ ìœ„ì¹˜ ì°¾ê¸°
   â”‚   firstComma = 3
   â”‚   secondComma = 7
   â”‚   thirdComma = 9
   â”‚
   â”œâ”€â†’ substring() â†’ ê°’ ì¶”ì¶œ
   â”‚   rStr = "255"
   â”‚   gStr = "0"
   â”‚   bStr = "0"
   â”‚
   â”œâ”€â†’ toInt() â†’ ì •ìˆ˜ ë³€í™˜
   â”‚   r = 255
   â”‚   g = 0
   â”‚   b = 0
   â”‚
   â”œâ”€â†’ constrain() â†’ ë²”ìœ„ ì œí•œ
   â”‚   r = 255 (0-255)
   â”‚   g = 0 (0-255)
   â”‚   b = 0 (0-255)
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Hardware Abstraction Layer]
   â”‚
   â”œâ”€â†’ setRGBLed(255, 0, 0)
   â”‚     analogWrite(LED_R_PIN, 255)
   â”‚     analogWrite(LED_G_PIN, 0)
   â”‚     analogWrite(LED_B_PIN, 0)
   â”‚
   â†“
[ì•„ë‘ì´ë…¸ Hardware Layer]
   â”‚
   â”œâ”€â†’ RGB LED í•˜ë“œì›¨ì–´
   â”‚   ë¹¨ê°• LED ì¼œì§ (ìµœëŒ€ ë°ê¸°)
   â”‚
   â†“
[ì‘ë‹µ ì „ì†¡]
   â”‚
   â”œâ”€â†’ sendAck()
   â”‚   BTSerial.print("ACK:OK_")
   â”‚
   â†“
[ì•±ì¸ë²¤í„° Communication Layer]
   â”‚
   â”œâ”€â†’ BluetoothClient1.DataReceived
   â”‚     receivedText = "ACK:OK_"
   â”‚
   â†“
[ì•±ì¸ë²¤í„° UI Layer]
   â”‚
   â”œâ”€â†’ Label_Status.Text = "ëª…ë ¹ ìˆ˜ì‹  í™•ì¸"
   â”‚
   â†“
[ì‚¬ìš©ì]
   â”‚
   â””â”€â†’ LEDê°€ ë¹¨ê°•ìƒ‰ìœ¼ë¡œ ì ë“±ë¨ì„ í™•ì¸
```

---

## 7. ì‹¤ì „ ì˜ˆì œ

### 7.1 ì˜ˆì œ 1: ìƒ‰ìƒ ê¸°ë°˜ ìë™ ë¶„ë¥˜

#### **ì‹œë‚˜ë¦¬ì˜¤**
- ì„¼ì„œê°€ ë¹¨ê°• ê°ì§€ â†’ LED ë¹¨ê°• ì ë“± + ì„œë³´ 45ë„
- ì„¼ì„œê°€ íŒŒë‘ ê°ì§€ â†’ LED íŒŒë‘ ì ë“± + ì„œë³´ 135ë„
- ì„¼ì„œê°€ ì´ˆë¡ ê°ì§€ â†’ LED ì´ˆë¡ ì ë“± + ì„œë³´ 90ë„

#### **ì•±ì¸ë²¤í„° ì½”ë“œ**

```
[ì „ì—­ ë³€ìˆ˜]
initialize global lastDetectedColor to ""

[Clock_AutoUpdate.Timer ì´ë²¤íŠ¸]
do
  if isConnected
  then
    call BluetoothClient1.SendText
      text: "REQ:COLOR_"

[BluetoothClient1.DataReceived ì´ë²¤íŠ¸]
do
  set local receivedText to
    call BluetoothClient1.ReceiveText
      numberOfBytes: -1
  
  if starts with (receivedText, "SENSOR:")
  then
    call parseSensorData (receivedText)
    call detectAndClassifyColor()

[í”„ë¡œì‹œì € detectAndClassifyColor]
do
  // ìƒ‰ìƒ íŒë³„ ì•Œê³ ë¦¬ì¦˜
  set local colorName to ""
  
  if and (redValue > 200, greenValue < 50, blueValue < 50)
  then
    set colorName to "RED"
  else if and (blueValue > 200, redValue < 50, greenValue < 50)
  then
    set colorName to "BLUE"
  else if and (greenValue > 200, redValue < 50, blueValue < 50)
  then
    set colorName to "GREEN"
  else
    set colorName to "UNKNOWN"
  
  // ìƒ‰ìƒì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ë™ì‘
  if colorName â‰  global lastDetectedColor
  then
    set global lastDetectedColor to colorName
    call executeClassification (colorName)

[í”„ë¡œì‹œì € executeClassification (color)]
do
  if color = "RED"
  then
    // LED ë¹¨ê°• + ì„œë³´ 45ë„
    call BluetoothClient1.SendText
      text: "CMD:LED,255,0,0_"
    call wait (100)  // 100ms ëŒ€ê¸°
    call BluetoothClient1.SendText
      text: "CMD:SERVO,45_"
    set Label_Status.Text to "ë¹¨ê°• ë¬¼ì²´ â†’ ì™¼ìª½"
  
  else if color = "BLUE"
  then
    // LED íŒŒë‘ + ì„œë³´ 135ë„
    call BluetoothClient1.SendText
      text: "CMD:LED,0,0,255_"
    call wait (100)
    call BluetoothClient1.SendText
      text: "CMD:SERVO,135_"
    set Label_Status.Text to "íŒŒë‘ ë¬¼ì²´ â†’ ì˜¤ë¥¸ìª½"
  
  else if color = "GREEN"
  then
    // LED ì´ˆë¡ + ì„œë³´ 90ë„
    call BluetoothClient1.SendText
      text: "CMD:LED,0,255,0_"
    call wait (100)
    call BluetoothClient1.SendText
      text: "CMD:SERVO,90_"
    set Label_Status.Text to "ì´ˆë¡ ë¬¼ì²´ â†’ ì¤‘ì•™"
```

#### **ì•„ë‘ì´ë…¸ ì½”ë“œ (ì¶”ê°€ ê¸°ëŠ¥)**

```cpp
// ìƒ‰ìƒ ìë™ ë¶„ë¥˜ ëª¨ë“œ
bool autoClassificationMode = false;

void handleControlCommand(String ctrlCmd) {
  // ê¸°ì¡´ ëª…ë ¹ ì²˜ë¦¬ ì½”ë“œ...
  
  // ìë™ ë¶„ë¥˜ ëª¨ë“œ On/Off
  if (ctrlCmd == "AUTO_CLASS_ON") {
    autoClassificationMode = true;
    sendAck();
  }
  else if (ctrlCmd == "AUTO_CLASS_OFF") {
    autoClassificationMode = false;
    sendAck();
  }
}

// ìë™ ë¶„ë¥˜ ì‹¤í–‰
void autoClassifyColor() {
  if (!autoClassificationMode) return;
  
  readColorSensor();
  
  // ë¹¨ê°• ê°ì§€
  if (sensorRed > 200 && sensorGreen < 50 && sensorBlue < 50) {
    setRGBLed(255, 0, 0);
    setServoAngle(45);
    BTSerial.print("CLASS:RED_");
  }
  // íŒŒë‘ ê°ì§€
  else if (sensorBlue > 200 && sensorRed < 50 && sensorGreen < 50) {
    setRGBLed(0, 0, 255);
    setServoAngle(135);
    BTSerial.print("CLASS:BLUE_");
  }
  // ì´ˆë¡ ê°ì§€
  else if (sensorGreen > 200 && sensorRed < 50 && sensorBlue < 50) {
    setRGBLed(0, 255, 0);
    setServoAngle(90);
    BTSerial.print("CLASS:GREEN_");
  }
}

void loop() {
  receiveBluetoothData();
  
  if (dataComplete) {
    processCommand(receivedData);
    receivedData = "";
    dataComplete = false;
  }
  
  // ìë™ ë¶„ë¥˜ ëª¨ë“œ ì‹¤í–‰
  autoClassifyColor();
  
  delay(100);
}
```

### 7.2 ì˜ˆì œ 2: ë°ì´í„° ë¡œê¹… ë° CSV ë‚´ë³´ë‚´ê¸°

#### **ì•±ì¸ë²¤í„° ì½”ë“œ**

```
[ì „ì—­ ë³€ìˆ˜]
initialize global dataLog to create empty list

[Button_SaveData.Click]
do
  // í˜„ì¬ ì‹œê°„ ìŠ¤íƒ¬í”„
  set local timestamp to
    call Clock1.FormatDateTime
      instant: Clock1.Now
      pattern: "yyyy-MM-dd HH:mm:ss"
  
  // ë°ì´í„° í–‰ ìƒì„± (CSV í˜•ì‹)
  set local dataRow to
    join timestamp
    ","
    global redValue
    ","
    global greenValue
    ","
    global blueValue
  
  // ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
  add items to list
    list: global dataLog
    item: dataRow
  
  // TinyDB ì €ì¥
  call TinyDB1.StoreValue
    tag: "sensorLog"
    valueToStore: global dataLog
  
  call Notifier1.ShowToast
    message: join "ë°ì´í„° ì €ì¥: " (length of list dataLog) "ê°œ"

[Button_ExportCSV.Click]
do
  // CSV í—¤ë” ìƒì„±
  set local csvContent to "Timestamp,Red,Green,Blue\n"
  
  // ë°ì´í„° í–‰ ì¶”ê°€
  for each item in global dataLog
    set csvContent to
      join csvContent
      item
      "\n"
  
  // íŒŒì¼ë¡œ ì €ì¥ (Sharing ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©)
  call Sharing1.ShareMessage
    message: csvContent

[Button_ClearLog.Click]
do
  set global dataLog to create empty list
  call TinyDB1.ClearAll
  call Notifier1.ShowToast
    message: "ë°ì´í„° ë¡œê·¸ ì‚­ì œ ì™„ë£Œ"
```

---

## 8. ë¬¸ì œ í•´ê²°

### 8.1 ë””ë²„ê¹… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### **ì•„ë‘ì´ë…¸ ì¸¡**

```cpp
// ë””ë²„ê·¸ í•¨ìˆ˜ ì¶”ê°€
void debugCommandProcess(String cmd) {
  Serial.println("==================");
  Serial.print("[ë””ë²„ê·¸] ìˆ˜ì‹ : ");
  Serial.println(cmd);
  Serial.print("[ë””ë²„ê·¸] ê¸¸ì´: ");
  Serial.println(cmd.length());
  Serial.print("[ë””ë²„ê·¸] 16ì§„ìˆ˜: ");
  for (int i = 0; i < cmd.length(); i++) {
    Serial.print(cmd[i], HEX);
    Serial.print(" ");
  }
  Serial.println();
  
  int colonPos = cmd.indexOf(':');
  Serial.print("[ë””ë²„ê·¸] ì½œë¡  ìœ„ì¹˜: ");
  Serial.println(colonPos);
  
  if (colonPos != -1) {
    Serial.print("[ë””ë²„ê·¸] í—¤ë”: ");
    Serial.println(cmd.substring(0, colonPos));
    Serial.print("[ë””ë²„ê·¸] í˜ì´ë¡œë“œ: ");
    Serial.println(cmd.substring(colonPos + 1));
  }
  Serial.println("==================");
}

void processCommand(String cmd) {
  #if ENABLE_DEBUG
    debugCommandProcess(cmd);
  #endif
  
  // ê¸°ì¡´ ì²˜ë¦¬ ë¡œì§...
}
```

#### **ì•±ì¸ë²¤í„° ì¸¡**

```
[í”„ë¡œì‹œì € debugDataReceived (data)]
do
  // ì›ë³¸ ë°ì´í„° í‘œì‹œ
  set Label_Debug1.Text to
    join "ì›ë³¸: " data
  
  // ë°ì´í„° ê¸¸ì´
  set Label_Debug2.Text to
    join "ê¸¸ì´: " (length data)
  
  // ì¢…ë£Œ ë¬¸ì í™•ì¸
  set local hasTerminator to
    call contains (data, "_")
  set Label_Debug3.Text to
    join "ì¢…ë£Œë¬¸ì: " (if hasTerminator then "ìˆìŒ" else "ì—†ìŒ")
  
  // í—¤ë” í™•ì¸
  set local colonPos to
    call index of (data, ":")
  if colonPos > 0
  then
    set Label_Debug4.Text to
      join "í—¤ë”: " (segment data, start: 1, length: colonPos-1)
  else
    set Label_Debug4.Text to "í—¤ë”: ì—†ìŒ"
```

### 8.2 ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ

#### **ë¬¸ì œ 1: ë°ì´í„°ê°€ ì§¤ë¦¼ (ë¶€ë¶„ ìˆ˜ì‹ )**

**ì¦ìƒ:**
```
ìˆ˜ì‹  ë°ì´í„°: "SENSO"
ë˜ëŠ”
ìˆ˜ì‹  ë°ì´í„°: "R:255,128"
```

**ì›ì¸:**
- ë¸”ë£¨íˆ¬ìŠ¤ ë²„í¼ê°€ ì‘ì•„ì„œ í•œ ë²ˆì— ì „ì†¡ ì•ˆ ë¨

**í•´ê²°:**

```cpp
// ì•„ë‘ì´ë…¸: ë°ì´í„°ë¥¼ ë‚˜ëˆ ì„œ ì „ì†¡í•˜ì§€ ì•Šê¸°
// ì˜ëª»ëœ ì˜ˆ:
BTSerial.print("SENSOR:");
delay(10);
BTSerial.print("255,128,64_");

// ì˜¬ë°”ë¥¸ ì˜ˆ:
String message = "SENSOR:255,128,64_";
BTSerial.print(message);
```

```
ì•±ì¸ë²¤í„°: ë°ì´í„° ëˆ„ì  ìˆ˜ì‹ 

[ì „ì—­ ë³€ìˆ˜]
initialize global receiveBuffer to ""

[BluetoothClient1.DataReceived]
do
  set local newData to
    call BluetoothClient1.ReceiveText (-1)
  
  // ë²„í¼ì— ëˆ„ì 
  set global receiveBuffer to
    join global receiveBuffer newData
  
  // ì¢…ë£Œ ë¬¸ì í™•ì¸
  if contains (global receiveBuffer, "_")
  then
    // ì™„ì „í•œ ë©”ì‹œì§€ ì²˜ë¦¬
    call parseSensorData (global receiveBuffer)
    set global receiveBuffer to ""  // ë²„í¼ ì´ˆê¸°í™”
```

#### **ë¬¸ì œ 2: ì‘ë‹µ ì§€ì—° (5ì´ˆ ì´ìƒ)**

**ì¦ìƒ:**
- ì„¼ì„œê°’ ìš”ì²­ í›„ 10ì´ˆ ì´ìƒ ì‘ë‹µ ì—†ìŒ

**ì›ì¸:**
- ì•„ë‘ì´ë…¸ì—ì„œ delay() ê³¼ë‹¤ ì‚¬ìš©

**í•´ê²°:**

```cpp
// ì˜ëª»ëœ ì˜ˆ: delay() ì‚¬ìš©
void handleRequest(String reqType) {
  if (reqType == "COLOR") {
    readColorSensor();
    delay(1000);  // â† 1ì´ˆ ì§€ì—° ë°œìƒ!
    sendColorData();
  }
}

// ì˜¬ë°”ë¥¸ ì˜ˆ: delay() ì œê±°
void handleRequest(String reqType) {
  if (reqType == "COLOR") {
    readColorSensor();
    sendColorData();  // ì¦‰ì‹œ ì „ì†¡
  }
}
```

#### **ë¬¸ì œ 3: ëª…ë ¹ ë¬´ì‹œ (ACK ì—†ìŒ)**

**ì¦ìƒ:**
- LED ì¼œê¸° ëª…ë ¹ ì „ì†¡í–ˆì§€ë§Œ ë°˜ì‘ ì—†ìŒ

**ì›ì¸:**
- ëª…ë ¹ í˜•ì‹ ì˜¤ë¥˜ (ê³µë°±, ëŒ€ì†Œë¬¸ì)

**ë””ë²„ê·¸:**

```
ì•±ì¸ë²¤í„°ì—ì„œ ì „ì†¡ ì „ í™•ì¸:

[Button_LED_Red.Click]
do
  set local command to "CMD:LED,255,0,0_"
  
  // ë””ë²„ê·¸ ì¶œë ¥
  set Label_Debug.Text to
    join "ì „ì†¡: [" command "]"
  
  call BluetoothClient1.SendText
    text: command
```

```cpp
// ì•„ë‘ì´ë…¸ ìˆ˜ì‹  í™•ì¸
void receiveBluetoothData() {
  while (BTSerial.available()) {
    char inChar = (char)BTSerial.read();
    
    // ë””ë²„ê·¸ ì¶œë ¥
    Serial.print("ë°›ì€ ë°”ì´íŠ¸: ");
    Serial.print(inChar);
    Serial.print(" (");
    Serial.print((int)inChar);
    Serial.println(")");
    
    if (inChar == '_') {
      dataComplete = true;
      Serial.print("ì™„ì„±ëœ ëª…ë ¹: [");
      Serial.print(receivedData);
      Serial.println("]");
      break;
    }
    
    receivedData += inChar;
  }
}
```

---

## 9. ì„±ëŠ¥ ìµœì í™”

### 9.1 ì•„ë‘ì´ë…¸ ìµœì í™”

#### **ë©”ëª¨ë¦¬ ìµœì í™”**

```cpp
// Before: String ì‚¬ìš© (ë™ì  ë©”ëª¨ë¦¬)
String receivedData = "";
receivedData += inChar;  // ë©”ëª¨ë¦¬ ì¬í• ë‹¹ ë¹ˆë²ˆ

// After: char ë°°ì—´ ì‚¬ìš© (ì •ì  ë©”ëª¨ë¦¬)
char receivedData[65];
uint8_t receiveIndex = 0;

void receiveBluetoothData() {
  while (BTSerial.available()) {
    char inChar = (char)BTSerial.read();
    
    if (inChar == '_') {
      receivedData[receiveIndex] = '\0';  // null ì¢…ë£Œ
      dataComplete = true;
      break;
    }
    
    if (receiveIndex < 64) {
      receivedData[receiveIndex++] = inChar;
    }
  }
}
```

#### **ì „ë ¥ ìµœì í™”**

```cpp
// ë””ë²„ê·¸ ì¶œë ¥ ìµœì†Œí™”
#define ENABLE_DEBUG 0  // ìš´ì˜ ëª¨ë“œ

// Serial ì¶œë ¥ ì¡°ê±´ë¶€
#if ENABLE_DEBUG
  Serial.println("ë””ë²„ê·¸ ë©”ì‹œì§€");
#endif

// delay() ìµœì†Œí™”
// Before:
delay(100);

// After: í•„ìš”í•œ ê²½ìš°ì—ë§Œ
delayMicroseconds(50);  // Î¼s ë‹¨ìœ„ ì‚¬ìš©
```

### 9.2 ì•±ì¸ë²¤í„° ìµœì í™”

#### **í”„ë¡œì‹œì € ì¬ì‚¬ìš©**

```
// Before: ì¤‘ë³µ ì½”ë“œ
[Button_LED_Red.Click]
do
  if isConnected
  then
    call BluetoothClient1.SendText ("CMD:LED,255,0,0_")

[Button_LED_Green.Click]
do
  if isConnected
  then
    call BluetoothClient1.SendText ("CMD:LED,0,255,0_")

// After: í”„ë¡œì‹œì € ì‚¬ìš©
[í”„ë¡œì‹œì € sendLedCommand (r, g, b)]
do
  if isConnected
  then
    set local command to
      join "CMD:LED," r "," g "," b "_"
    call BluetoothClient1.SendText (command)

[Button_LED_Red.Click]
do
  call sendLedCommand (255, 0, 0)

[Button_LED_Green.Click]
do
  call sendLedCommand (0, 255, 0)
```

---

## 10. ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- **[09_ì•±ì¸ë²¤í„°_ì•„ë‘ì´ë…¸_ì„¼ì„œí†µì‹ _í”„ë¡œí† ì½œ.md](docs/09_ì•±ì¸ë²¤í„°_ì•„ë‘ì´ë…¸_ì„¼ì„œí†µì‹ _í”„ë¡œí† ì½œ.md)** - ì „ì²´ ì‹œìŠ¤í…œ ê°€ì´ë“œ
- **[10_app_inventor_sensor_protocol.ino](arduino_code/day2_conveyor_system/10_app_inventor_sensor_protocol/)** - ì•„ë‘ì´ë…¸ ì „ì²´ ì†ŒìŠ¤

### ê³µì‹ ë¬¸ì„œ
- MIT App Inventor: https://appinventor.mit.edu/
- Arduino Reference: https://www.arduino.cc/reference/
- TCS34725 ì„¼ì„œ: https://learn.adafruit.com/adafruit-color-sensors/

---

**ì‘ì„±ì¼:** 2026-01-31  
**ë²„ì „:** 2.0 (ì™„ì „ ê°•í™”íŒ)  
**í”„ë¡œì íŠ¸:** Smart Factory Arms Project

**í¬í•¨ ë‚´ìš©:**
âœ… ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (4ê°œ ë ˆì´ì–´)  
âœ… í”„ë¡œí† ì½œ í†µì‹  ê·œì•½ (BNF í‘œê¸°ë²•)  
âœ… ì•„ë‘ì´ë…¸ í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ (4ê°œ)  
âœ… ì•±ì¸ë²¤í„° í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ (3ê°œ)  
âœ… ë°ì´í„° íë¦„ë„ (ìƒì„¸)  
âœ… ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨  
âœ… ì‹¤ì „ ì˜ˆì œ ì½”ë“œ  
âœ… ë””ë²„ê¹… ê°€ì´ë“œ  
âœ… ì„±ëŠ¥ ìµœì í™”
